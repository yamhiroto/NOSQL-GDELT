{"paragraphs":[{"text":"%md\n## Exploration des donnees GDELT via Spark\nDans ce notebook nous allons commencer a explorer les donnees GDELT qu'on a stoque sur S3","dateUpdated":"2020-01-14T12:16:36+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Exploration des donnees GDELT via Spark</h2>\n<p>Dans ce notebook nous allons commencer a explorer les donnees GDELT qu&rsquo;on a stoque sur S3</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579004196810_-242215774","id":"20181212-102323_67420128","dateCreated":"2020-01-14T12:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:365"},{"text":"%md\n","user":"anonymous","dateUpdated":"2020-01-15T20:16:42+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579119402282_-1315404448","id":"20200115-201642_1185871106","dateCreated":"2020-01-15T20:16:42+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1671"},{"text":"%md Les fichiers sont stoquees compresses, on a besoin d'un bout de code pour les decompresser en parallel sur les workers au fur et a mesure qu'on les lit depuis S3:","dateUpdated":"2020-01-14T12:16:36+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Les fichiers sont stoquees compresses, on a besoin d&rsquo;un bout de code pour les decompresser en parallel sur les workers au fur et a mesure qu&rsquo;on les lit depuis S3:</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579004196817_-234136047","id":"20181212-102329_808049084","dateCreated":"2020-01-14T12:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:366"},{"text":"%md\n","user":"anonymous","dateUpdated":"2020-01-14T14:45:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579013119788_58823822","id":"20200114-144519_754603050","dateCreated":"2020-01-14T14:45:19+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:367"},{"text":"import spark.implicits._\nimport org.apache.spark.sql.functions._","user":"anonymous","dateUpdated":"2020-01-14T14:58:23+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import spark.implicits._\nimport org.apache.spark.sql.functions._\n"}]},"apps":[],"jobName":"paragraph_1579004196818_-232981800","id":"20200111-162130_782083733","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T14:58:23+0000","dateFinished":"2020-01-14T14:58:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:368"},{"text":"%md\n### EVENT","dateUpdated":"2020-01-14T12:16:36+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>EVENT</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579004196818_-232981800","id":"20200111-162721_1795268925","dateCreated":"2020-01-14T12:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:369"},{"text":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\n// 20181201000000.export.CSV.zip\nval textRDD = sc.binaryFiles(\"/tmp/20181201[0-9]*.export.CSV.zip\"). // charger quelques fichers via une regex\n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n","user":"anonymous","dateUpdated":"2020-01-14T14:58:26+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\ntextRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[44] at flatMap at <console>:69\n"}]},"apps":[],"jobName":"paragraph_1579004196819_-233366549","id":"20200113-140431_2051607335","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T14:58:26+0000","dateFinished":"2020-01-14T14:58:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:370"},{"text":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\n// 20181201000000.export.CSV.zip\nval textRDD = sc.binaryFiles(\"/zeppelin/tmp/20181201[0-9]*.export.CSV.zip\"). // charger quelques fichers via une regex\n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n\nval eventDF = textRDD.toDF()\n.withColumn(\"GLOBALEVENTID\", split($\"value\", \"\\\\t\").getItem(0))\n.withColumn(\"Day\", split($\"value\", \"\\\\t\").getItem(1))\n.withColumn(\"MonthYear\", split($\"value\", \"\\\\t\").getItem(2))\n.withColumn(\"Year\", split($\"value\", \"\\\\t\").getItem(3))\n.withColumn(\"FractionDate\", split($\"value\", \"\\\\t\").getItem(4))\n.withColumn(\"Actor1Code\", split($\"value\", \"\\\\t\").getItem(5))\n.withColumn(\"Actor1Name\", split($\"value\", \"\\\\t\").getItem(6))\n.withColumn(\"Actor1CountryCode\", split($\"value\", \"\\\\t\").getItem(7))\n.withColumn(\"Actor1KnownGroupCode\", split($\"value\", \"\\\\t\").getItem(8))\n.withColumn(\"Actor1EthnicCode\", split($\"value\", \"\\\\t\").getItem(9))\n.withColumn(\"Actor1Religion1Code\", split($\"value\", \"\\\\t\").getItem(10))\n.withColumn(\"Actor1Religion2Code\", split($\"value\", \"\\\\t\").getItem(11))\n.withColumn(\"Actor1Type1Code\", split($\"value\", \"\\\\t\").getItem(12))\n.withColumn(\"Actor1Type2Code\", split($\"value\", \"\\\\t\").getItem(13))\n.withColumn(\"Actor1Type3Code\", split($\"value\", \"\\\\t\").getItem(14))\n.withColumn(\"Actor2Code\", split($\"value\", \"\\\\t\").getItem(15))\n.withColumn(\"Actor2Name\", split($\"value\", \"\\\\t\").getItem(16))\n.withColumn(\"Actor2CountryCode\", split($\"value\", \"\\\\t\").getItem(17))\n.withColumn(\"Actor2KnownGroupCode\", split($\"value\", \"\\\\t\").getItem(18))\n.withColumn(\"Actor2EthnicCode\", split($\"value\", \"\\\\t\").getItem(19))\n.withColumn(\"Actor2Religion1Code\", split($\"value\", \"\\\\t\").getItem(20))\n.withColumn(\"Actor2Religion2Code\", split($\"value\", \"\\\\t\").getItem(21))\n.withColumn(\"Actor2Type1Code\", split($\"value\", \"\\\\t\").getItem(22))\n.withColumn(\"Actor2Type2Code\", split($\"value\", \"\\\\t\").getItem(23))\n.withColumn(\"Actor2Type3Code\", split($\"value\", \"\\\\t\").getItem(24))\n.withColumn(\"IsRootEvent\", split($\"value\", \"\\\\t\").getItem(25))\n.withColumn(\"EventCode\", split($\"value\", \"\\\\t\").getItem(26))\n.withColumn(\"EventBaseCode\", split($\"value\", \"\\\\t\").getItem(27))\n.withColumn(\"EventRootCode\", split($\"value\", \"\\\\t\").getItem(28))\n.withColumn(\"QuadClass\", split($\"value\", \"\\\\t\").getItem(29))\n.withColumn(\"GoldsteinScale\", split($\"value\", \"\\\\t\").getItem(30))\n.withColumn(\"NumMentions\", split($\"value\", \"\\\\t\").getItem(31))\n.withColumn(\"NumSources\", split($\"value\", \"\\\\t\").getItem(32))\n.withColumn(\"NumArticles\", split($\"value\", \"\\\\t\").getItem(33))\n.withColumn(\"AvgTone\", split($\"value\", \"\\\\t\").getItem(34))\n.withColumn(\"Actor1Geo_Type\", split($\"value\", \"\\\\t\").getItem(35))\n.withColumn(\"Actor1Geo_FullName\", split($\"value\", \"\\\\t\").getItem(36))\n.withColumn(\"Actor1Geo_CountryCode\", split($\"value\", \"\\\\t\").getItem(37))\n.withColumn(\"Actor1Geo_ADM1Code\", split($\"value\", \"\\\\t\").getItem(38))\n.withColumn(\"Actor1Geo_ADM2Code\", split($\"value\", \"\\\\t\").getItem(39))\n.withColumn(\"Actor1Geo_Lat\", split($\"value\", \"\\\\t\").getItem(40))\n.withColumn(\"Actor1Geo_Long\", split($\"value\", \"\\\\t\").getItem(41))\n.withColumn(\"Actor1Geo_FeatureID\", split($\"value\", \"\\\\t\").getItem(42))\n.withColumn(\"Actor2Geo_Type\", split($\"value\", \"\\\\t\").getItem(43))\n.withColumn(\"Actor2Geo_FullName\", split($\"value\", \"\\\\t\").getItem(44))\n.withColumn(\"Actor2Geo_CountryCode\", split($\"value\", \"\\\\t\").getItem(45))\n.withColumn(\"Actor2Geo_ADM1Code\", split($\"value\", \"\\\\t\").getItem(46))\n.withColumn(\"Actor2Geo_ADM2Code\", split($\"value\", \"\\\\t\").getItem(47))\n.withColumn(\"Actor2Geo_Lat\", split($\"value\", \"\\\\t\").getItem(48))\n.withColumn(\"Actor2Geo_Long\", split($\"value\", \"\\\\t\").getItem(49))\n.withColumn(\"Actor2Geo_FeatureID\", split($\"value\", \"\\\\t\").getItem(50))\n.withColumn(\"ActionGeo_Type\", split($\"value\", \"\\\\t\").getItem(51))\n.withColumn(\"ActionGeo_FullName\", split($\"value\", \"\\\\t\").getItem(52))\n.withColumn(\"ActionGeo_CountryCode\", split($\"value\", \"\\\\t\").getItem(53))\n.withColumn(\"ActionGeo_ADM1Code\", split($\"value\", \"\\\\t\").getItem(54))\n.withColumn(\"ActionGeo_ADM2Code\", split($\"value\", \"\\\\t\").getItem(55))\n.withColumn(\"ActionGeo_Lat\", split($\"value\", \"\\\\t\").getItem(56))\n.withColumn(\"ActionGeo_Long\", split($\"value\", \"\\\\t\").getItem(57))\n.withColumn(\"ActionGeo_FeatureID\", split($\"value\", \"\\\\t\").getItem(58))\n.withColumn(\"DATEADDED\", split($\"value\", \"\\\\t\").getItem(59))\n.withColumn(\"SOURCEURL\", split($\"value\", \"\\\\t\").getItem(60))\n.drop($\"value\")\n","user":"anonymous","dateUpdated":"2020-01-15T21:01:07+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":195.994,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\ntextRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[60] at flatMap at <console>:89\neventDF: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, Day: string ... 59 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579004196820_-235290294","id":"20171217-232457_1732696781","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T15:00:12+0000","dateFinished":"2020-01-14T15:00:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:371"},{"text":"val eventDF_selected  = eventDF.select(\"GLOBALEVENTID\",\"Day\",\"MonthYear\",\"Year\",\"Actor1Name\",\"Actor1CountryCode\",\"Actor2Name\",\"Actor2CountryCode\",\"NumMentions\",\"NumArticles\",\"AvgTone\",\"ActionGeo_FullName\",\"ActionGeo_CountryCode\") \neventDF_selected.show\n\n","user":"anonymous","dateUpdated":"2020-01-14T15:00:56+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"eventDF_selected: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, Day: string ... 11 more fields]\n+-------------+--------+---------+----+----------+-----------------+--------------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+\n|GLOBALEVENTID|     Day|MonthYear|Year|Actor1Name|Actor1CountryCode|    Actor2Name|Actor2CountryCode|NumMentions|NumArticles|          AvgTone|  ActionGeo_FullName|ActionGeo_CountryCode|\n+-------------+--------+---------+----+----------+-----------------+--------------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+\n|    806933491|20171201|   201712|2017|          |                 |     ARGENTINE|              ARG|          3|          3| 2.02578268876611|               India|                   IN|\n|    806933492|20171201|   201712|2017| ARGENTINE|              ARG|              |                 |          3|          3| 2.02578268876611|               India|                   IN|\n|    806933493|20171201|   201712|2017|     GREEK|              GRC|       TURKISH|              TUR|         10|         10|-5.24017467248908|Ankara, Ankara, T...|                   TU|\n|    806933494|20171201|   201712|2017|     GREEK|              GRC|       TURKISH|              TUR|         10|         10|-5.24017467248908|Athens, AttikíR, ...|                   GR|\n|    806933495|20171201|   201712|2017|    KUWAIT|              KWT|          PERU|              PER|          4|          4|-0.99150141643059|              Kuwait|                   KU|\n|    806933496|20171201|   201712|2017|   TURKISH|              TUR|         GREEK|              GRC|         10|         10|-5.24017467248908|Ankara, Ankara, T...|                   TU|\n|    806933497|20181101|   201811|2018|  JAPANESE|              JPN|        TOYOTA|              JPN|          6|          6| 1.92307692307693|               Japan|                   JA|\n|    806933498|20181101|   201811|2018|  JAPANESE|              JPN|         JAPAN|              JPN|          4|          4| 1.92307692307693|               Japan|                   JA|\n|    806933499|20181124|   201811|2018|FIRST LADY|                 |    WASHINGTON|              USA|          1|          1|-3.14285714285715|              Russia|                   RS|\n|    806933500|20181124|   201811|2018|FIRST LADY|                 |    WASHINGTON|              USA|          7|          7|-3.14285714285715|             Ukraine|                   UP|\n|    806933501|20181124|   201811|2018| PROTESTER|                 |      CANADIAN|              CAN|          8|          8|-6.63265306122449|      United Kingdom|                   UK|\n|    806933502|20181124|   201811|2018|PHILIPPINE|              PHL|              |                 |          2|          2|-1.81818181818182|Bacolod, Bacolod,...|                   RP|\n|    806933503|20181124|   201811|2018|PHILIPPINE|              PHL|              |                 |          2|          2|-1.81818181818182|Negros Occidental...|                   RP|\n|    806933504|20181130|   201811|2018| ECONOMIST|                 |        THE US|              USA|         10|         10|-7.17821782178218|               China|                   CH|\n|    806933505|20181201|   201812|2018|          |                 |     ARGENTINA|              ARG|         10|         10| 2.64705882352942|               India|                   IN|\n|    806933506|20181201|   201812|2018|          |                 |      PRODUCER|                 |          3|          3|-0.71736011477761|New York, United ...|                   US|\n|    806933507|20181201|   201812|2018|          |                 |        CANADA|              CAN|         10|         10| 1.43884892086331|              Canada|                   CA|\n|    806933508|20181201|   201812|2018|          |                 |         CHINA|              CHN|         10|         10|-1.89573459715639|Kerch Strait, Rus...|                   RS|\n|    806933509|20181201|   201812|2018|          |                 |ROMAN CATHOLIC|                 |          3|          3|-1.10787172011662|Los Pinos, Tlaxca...|                   MX|\n|    806933510|20181201|   201812|2018|          |                 |ROMAN CATHOLIC|                 |          2|          2|-1.10787172011662|Los Pinos, Tlaxca...|                   MX|\n+-------------+--------+---------+----+----------+-----------------+--------------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579004196821_-235675043","id":"20200113-140537_1512216284","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T15:00:56+0000","dateFinished":"2020-01-14T15:00:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:372"},{"text":"%md\n### GLOBAL KNOWLEDGE GRAPH","dateUpdated":"2020-01-14T12:16:36+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>GLOBAL KNOWLEDGE GRAPH</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579004196821_-235675043","id":"20200111-162229_916549909","dateCreated":"2020-01-14T12:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:373"},{"text":"val gkgRDD = sc.binaryFiles(\"/zeppelin/tmp/20181201234500.gkg.csv.zip\"). // charger quelques fichers via une regex   // essai sur un seul fichier ! remplacer par \"/tmp/20181201[0-9]*.gkg.csv.zip\" pour avoir acces a tous les fichiers\n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n\nval gkgDF = gkgRDD.toDF()\n.withColumn(\"GKGRECORDID\", split($\"value\", \"\\\\t\").getItem(0))\n.withColumn(\"DATE\", split($\"value\", \"\\\\t\").getItem(1))\n.withColumn(\"SourceCollectionIdentifier\", split($\"value\", \"\\\\t\").getItem(2))\n.withColumn(\"SourceCommonName\", split($\"value\", \"\\\\t\").getItem(3))\n.withColumn(\"DocumentIdentifier\", split($\"value\", \"\\\\t\").getItem(4))\n.withColumn(\"Counts\", split($\"value\", \"\\\\t\").getItem(5))\n.withColumn(\"V2Counts\", split($\"value\", \"\\\\t\").getItem(6))\n.withColumn(\"Themes\", split($\"value\", \"\\\\t\").getItem(7))\n.withColumn(\"V2Themes\", split($\"value\", \"\\\\t\").getItem(8))\n.withColumn(\"Locations\", split($\"value\", \"\\\\t\").getItem(9))\n.withColumn(\"V2Locations\", split($\"value\", \"\\\\t\").getItem(10))\n.withColumn(\"Persons\", split($\"value\", \"\\\\t\").getItem(11))\n.withColumn(\"V2Persons\", split($\"value\", \"\\\\t\").getItem(12))\n.withColumn(\"Organizations\", split($\"value\", \"\\\\t\").getItem(13))\n.withColumn(\"V2Organizations\", split($\"value\", \"\\\\t\").getItem(14))\n.withColumn(\"V2Tone\", split($\"value\", \"\\\\t\").getItem(15))\n.withColumn(\"Dates\", split($\"value\", \"\\\\t\").getItem(16))\n.withColumn(\"GCAM\", split($\"value\", \"\\\\t\").getItem(17))\n.withColumn(\"SharingImage\", split($\"value\", \"\\\\t\").getItem(18))\n.withColumn(\"RelatedImages\", split($\"value\", \"\\\\t\").getItem(19))\n.withColumn(\"SocialImageEmbeds\", split($\"value\", \"\\\\t\").getItem(20))\n.withColumn(\"SocialVideoEmbeds\", split($\"value\", \"\\\\t\").getItem(21))\n.withColumn(\"Quotations\", split($\"value\", \"\\\\t\").getItem(22))\n.withColumn(\"AllNames\", split($\"value\", \"\\\\t\").getItem(23))\n.withColumn(\"Amounts\", split($\"value\", \"\\\\t\").getItem(24))\n.withColumn(\"TranslationInfo\", split($\"value\", \"\\\\t\").getItem(25))\n.withColumn(\"Extras\", split($\"value\", \"\\\\t\").getItem(26))\n.drop($\"value\")","user":"anonymous","dateUpdated":"2020-01-14T15:00:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"gkgRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[65] at flatMap at <console>:88\ngkgDF: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, DATE: string ... 25 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579004196822_-234520796","id":"20200111-160038_1308018681","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T15:00:59+0000","dateFinished":"2020-01-14T15:01:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:374"},{"text":"val gkgDF_selected = gkgDF.select(\"GKGRECORDID\",\"DATE\",\"SourceCommonName\",\"DocumentIdentifier\",\"Themes\",\"Locations\",\"Persons\",\"Organizations\",\n\"V2Tone\",\"TranslationInfo\")   //on ne prend pas les V2 car ils prennent en compte les doublons   / doit on remplacer Persons et Organizations par AllNames?\ngkgDF_selected.show","user":"anonymous","dateUpdated":"2020-01-14T15:01:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"gkgDF_selected: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, DATE: string ... 8 more fields]\n+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------+\n|      GKGRECORDID|          DATE|    SourceCommonName|  DocumentIdentifier|              Themes|           Locations|             Persons|       Organizations|              V2Tone|TranslationInfo|\n+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------+\n| 20181201234500-0|20181201234500|             news.am|https://news.am/e...|TAX_ETHNICITY;TAX...|1#Armenia#AM#AM#4...|     nikol pashinyan|                    |0,0.9259259259259...|               |\n| 20181201234500-1|20181201234500|californiagoldenb...|https://www.calif...|                    |2#California, Uni...|stanford cardinal...|                    |0,4.8387096774193...|               |\n| 20181201234500-2|20181201234500|              qz.com|https://qz.com/qu...|WB_1331_HEALTH_TE...|2#New York, Unite...|                    |google;facebook;m...|2.27817745803357,...|               |\n| 20181201234500-3|20181201234500|        buzzfeed.com|https://www.buzzf...|                    |                    |                    |              disney|4.34782608695652,...|               |\n| 20181201234500-4|20181201234500|     animalforum.com|http://www.animal...|                    |                    |                    |welcome to animal...|5.26315789473684,...|               |\n| 20181201234500-5|20181201234500|          iheart.com|https://kogo.ihea...|                    |4#Alhambra, Casti...|    nightflyers syfy|             netflix|1.42517814726841,...|               |\n| 20181201234500-6|20181201234500|voiceofalexandria...|https://www.voice...|TAX_FNCACT;TAX_FN...|4#Moscow, Moskva,...|donald trump;vlad...|reagan presidenti...|-5.55555555555556...|               |\n| 20181201234500-7|20181201234500|        turnto23.com|https://www.turnt...|TAX_MILITARY_TITL...|4#Arabian Sea, In...|john richardson;p...|u s naval forces ...|-3.2,1.6,4.8,6.4,...|               |\n| 20181201234500-8|20181201234500|         570news.com|https://www.570ne...|WB_2670_JOBS;WB_6...|                    |nate grimes;braxt...|    associated press|-3.76344086021505...|               |\n| 20181201234500-9|20181201234500|          iheart.com|https://kissfm107...|MANMADE_DISASTER_...|1#United States#U...|lucien grainge;mo...|music group;unive...|2.44755244755245,...|               |\n|20181201234500-10|20181201234500|          wvnews.com|https://www.wvnew...|TAKE_OFFICE;TAX_F...|1#Mexico#MX#MX#23...|donald trump;pena...|national palace;l...|-0.64043915827996...|               |\n|20181201234500-11|20181201234500|thenationonlineng...|http://thenationo...|TAX_FNCACT;TAX_FN...|1#Nigeria#NI#NI#1...|                    |energy solutions;...|2.98507462686567,...|               |\n|20181201234500-12|20181201234500|     98theticket.com|http://www.98thet...|                    |2#Florida, United...|darriel mack;tere...|                espn|-2.11640211640212...|               |\n|20181201234500-13|20181201234500|            wbir.com|https://www.wbir....|WB_1979_NATURAL_R...|                    |                    |gatlinburg fire d...|-0.84745762711864...|               |\n|20181201234500-14|20181201234500|southeastasiapost...|https://www.south...|TAX_FNCACT;TAX_FN...|4#Gurudwara, Hary...|shah mahmood qure...|             twitter|0.711743772241993...|               |\n|20181201234500-15|20181201234500|            wirx.com|https://www.wirx....|LEADER;TAX_FNCACT...|3#Great Lakes, Mi...|          fred upton|u s army corps;u ...|1.3953488372093,3...|               |\n|20181201234500-16|20181201234500|goldcoastbulletin...|https://www.goldc...|TAX_FNCACT;TAX_FN...|1#Australia#AS#AS...|                    |                    |-0.42283298097251...|               |\n|20181201234500-17|20181201234500|         570news.com|https://www.570ne...|                    |4#Grand Forks, Br...|trevon allen;fili...|    associated press|-1.70454545454545...|               |\n|20181201234500-18|20181201234500|            wlos.com|https://wlos.com/...|     TAX_ECON_PRICE;|                    |                    |                    |2.77777777777778,...|               |\n|20181201234500-19|20181201234500|lajuntatribunedem...|http://www.lajunt...|WB_698_TRADE;TAX_...|1#Australia#AS#AS...|angela merkel;don...|international mon...|-2.09090909090909...|               |\n+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579004196822_-234520796","id":"20200111-160341_388192140","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T15:01:02+0000","dateFinished":"2020-01-14T15:01:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:375"},{"text":"%md\n### MENTION ","dateUpdated":"2020-01-14T17:00:21+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>MENTION</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579004196823_-234905545","id":"20200111-161729_1436776043","dateCreated":"2020-01-14T12:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:376"},{"text":"val mentionRDD = sc.binaryFiles(\"/zeppelin/tmp/20181201[0-9]*.mentions.CSV.zip\"). // charger quelques fichers via une regex   // essai sur un seul fichier ! remplacer par \"/tmp/20181201[0-9]*.mentions.CSV.zip\" pour avoir acces a tous les fichiers\n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\nval mentionDF = mentionRDD.toDF()\n.withColumn(\"GLOBALEVENTID\", split($\"value\", \"\\\\t\").getItem(0))\n.withColumn(\"EventTimeDate\", split($\"value\", \"\\\\t\").getItem(1))\n.withColumn(\"MentionTimeDate\", split($\"value\", \"\\\\t\").getItem(2))\n.withColumn(\"MentionType\", split($\"value\", \"\\\\t\").getItem(3))\n.withColumn(\"MentionSourceName\", split($\"value\", \"\\\\t\").getItem(4))\n.withColumn(\"MentionIdentifier\", split($\"value\", \"\\\\t\").getItem(5))\n.withColumn(\"SentenceID\", split($\"value\", \"\\\\t\").getItem(6))\n.withColumn(\"Actor1CharOffset\", split($\"value\", \"\\\\t\").getItem(7))\n.withColumn(\"Actor2CharOffset\", split($\"value\", \"\\\\t\").getItem(8))\n.withColumn(\"ActionCharOffset\", split($\"value\", \"\\\\t\").getItem(9))\n.withColumn(\"InRawText\", split($\"value\", \"\\\\t\").getItem(10))\n.withColumn(\"Confidence\", split($\"value\", \"\\\\t\").getItem(11))\n.withColumn(\"MentionDocLen\", split($\"value\", \"\\\\t\").getItem(12))\n.withColumn(\"MentionDocTone\", split($\"value\", \"\\\\t\").getItem(13))\n.withColumn(\"MentionDocTranslationInfo\", split($\"value\", \"\\\\t\").getItem(14))\n.withColumn(\"Extras\", split($\"value\", \"\\\\t\").getItem(15))\n.withColumn(\"Langue_1\", when (col(\"MentionDocTranslationInfo\") === \"\", \"Eng\").otherwise(col(\"MentionDocTranslationInfo\")))\n.withColumn(\"Langue_2\", split($\"Langue_1\", \";\").getItem(0))\n.drop($\"Langue_1\")\n.drop($\"value\")\n","user":"anonymous","dateUpdated":"2020-01-14T17:09:45+0000","config":{"tableHide":true,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mentionRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[417] at flatMap at <console>:88\nmentionDF: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, EventTimeDate: string ... 15 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579004196823_-234905545","id":"20200111-162803_300481733","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T17:09:03+0000","dateFinished":"2020-01-14T17:09:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:377"},{"text":"val mentionDF_selected = mentionDF.select(\"GLOBALEVENTID\",\"EventTimeDate\",\"MentionTimeDate\",\"MentionSourceName\",\"MentionDocTone\",\"MentionDocTranslationInfo\",\"Langue_2\").filter($\"Langue_2\" === \"Eng\")\nmentionDF_selected.show()  //on pourrait retirer InRawText, Confidence, MentionDocLen ","user":"anonymous","dateUpdated":"2020-01-14T17:10:37+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mentionDF_selected: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, EventTimeDate: string ... 5 more fields]\n+-------------+--------------+---------------+-------------------+-----------------+-------------------------+--------+\n|GLOBALEVENTID| EventTimeDate|MentionTimeDate|  MentionSourceName|   MentionDocTone|MentionDocTranslationInfo|Langue_2|\n+-------------+--------------+---------------+-------------------+-----------------+-------------------------+--------+\n|    711400976|20171201000000| 20181201013000|    unionleader.com|-12.4497991967872|                         |     Eng|\n|    806769087|20181201004500| 20181201013000|myrecordjournal.com|-5.75539568345323|                         |     Eng|\n|    806769088|20181201004500| 20181201013000|myrecordjournal.com|-5.75539568345323|                         |     Eng|\n|    806769089|20181201004500| 20181201013000|myrecordjournal.com|-5.75539568345323|                         |     Eng|\n|    711665577|20171201210000| 20181201013000|   newspressnow.com|-1.63419233186675|                         |     Eng|\n|    806754253|20181201000000| 20181201013000|        680news.com|-2.54826254826255|                         |     Eng|\n|    806754253|20181201000000| 20181201013000|         kansas.com|-2.84237726098192|                         |     Eng|\n|    806754254|20181201000000| 20181201013000|        680news.com|-2.54826254826255|                         |     Eng|\n|    806754254|20181201000000| 20181201013000|         kansas.com|-2.84237726098192|                         |     Eng|\n|    711507840|20171201084500| 20181201013000|  theregister.co.uk|                0|                         |     Eng|\n|    806780335|20181201013000| 20181201013000|   newsletter.co.uk|-6.50406504065041|                         |     Eng|\n|    806780336|20181201013000| 20181201013000|island-reporter.com|            3.125|                         |     Eng|\n|    711515870|20171201094500| 20181201013000|island-reporter.com|            3.125|                         |     Eng|\n|    806754258|20181201000000| 20181201013000|        680news.com|-2.54826254826255|                         |     Eng|\n|    806754258|20181201000000| 20181201013000|         kansas.com|-2.84237726098192|                         |     Eng|\n|    806754260|20181201000000| 20181201013000|        680news.com|-2.54826254826255|                         |     Eng|\n|    806754260|20181201000000| 20181201013000|         kansas.com|-2.84237726098192|                         |     Eng|\n|    711535246|20171201110000| 20181201013000|island-reporter.com|            3.125|                         |     Eng|\n|    711513126|20171201093000| 20181201013000| wallacesfarmer.com| 0.15197568389058|                         |     Eng|\n|    711455813|20171201033000| 20181201013000|           koaa.com|-3.49650349650349|                         |     Eng|\n+-------------+--------------+---------------+-------------------+-----------------+-------------------------+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579004196823_-234905545","id":"20200111-163126_611491370","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-14T17:10:37+0000","dateFinished":"2020-01-14T17:10:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:378"},{"text":"mentionDF_selected.select(\"MentionDocTranslationInfo\").distinct.show  // aucune valeur distincte ressemblant à \"srclc:ara;eng:GT-ARA 1.0\" dans notre jeu de données","user":"anonymous","dateUpdated":"2020-01-14T17:13:36+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------------+\n|MentionDocTranslationInfo|\n+-------------------------+\n|                         |\n+-------------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1579018748877_100649773","id":"20200114-161908_1309992376","dateCreated":"2020-01-14T16:19:08+0000","dateStarted":"2020-01-14T17:11:56+0000","dateFinished":"2020-01-14T17:12:06+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:379"},{"text":"val event_mention_DF = eventDF_selected.join(mentionDF_selected,\"GlobalEventID\")\n\nevent_mention_DF.show","user":"anonymous","dateUpdated":"2020-01-15T21:04:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"event_mention_DF: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, Day: string ... 17 more fields]\n+-------------+--------+---------+----+------------+-----------------+--------------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\n|GLOBALEVENTID|     Day|MonthYear|Year|  Actor1Name|Actor1CountryCode|    Actor2Name|Actor2CountryCode|NumMentions|NumArticles|          AvgTone|  ActionGeo_FullName|ActionGeo_CountryCode| EventTimeDate|MentionTimeDate|   MentionSourceName|   MentionDocTone|MentionDocTranslationInfo|Langue_2|\n+-------------+--------+---------+----+------------+-----------------+--------------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\n|    806754408|20181201|   201812|2018|            |                 |         VOTER|                 |          6|          6|-3.91061452513966|Broward County, F...|                   US|20181201000000| 20181201001500|        mynews13.com|-3.91061452513966|                         |     Eng|\n|    806754408|20181201|   201812|2018|            |                 |         VOTER|                 |          6|          6|-3.91061452513966|Broward County, F...|                   US|20181201000000| 20181201000000|        baynews9.com|-3.91061452513966|                         |     Eng|\n|    806755037|20181201|   201812|2018|    INDUSTRY|                 |              |                 |          5|          5|  2.5089605734767|London, London, C...|                   UK|20181201000000| 20181201154500|yourelection15.co.uk|-1.17328519855595|                         |     Eng|\n|    806755037|20181201|   201812|2018|    INDUSTRY|                 |              |                 |          5|          5|  2.5089605734767|London, London, C...|                   UK|20181201000000| 20181201000000|          apnews.com|  2.5089605734767|                         |     Eng|\n|    806755131|20181201|   201812|2018|    INDUSTRY|                 |      NEW YORK|              USA|         10|         10|  2.3121387283237|New York, United ...|                   US|20181201000000| 20181201054500|            wral.com| -1.0228166797797|                         |     Eng|\n|    806755131|20181201|   201812|2018|    INDUSTRY|                 |      NEW YORK|              USA|         10|         10|  2.3121387283237|New York, United ...|                   US|20181201000000| 20181201114500|    readingeagle.com| 0.69204152249135|                         |     Eng|\n|    806755131|20181201|   201812|2018|    INDUSTRY|                 |      NEW YORK|              USA|         10|         10|  2.3121387283237|New York, United ...|                   US|20181201000000| 20181201000000|     therealdeal.com|  2.3121387283237|                         |     Eng|\n|    806755294|20181201|   201812|2018|SASKATCHEWAN|              CAN|              |                 |          6|          6| -3.4136546184739|Saskatchewan, Man...|                   CA|20181201000000| 20181201000000|  thestarphoenix.com| -3.4136546184739|                         |     Eng|\n|    806755371|20181201|   201812|2018|     CHINESE|              CHN|CONSUL GENERAL|                 |          2|          2|-0.27662517289074|Huang Ping, Sichu...|                   CH|20181201000000| 20181201060000|             msn.com|-0.51679586563307|                         |     Eng|\n|    806755371|20181201|   201812|2018|     CHINESE|              CHN|CONSUL GENERAL|                 |          2|          2|-0.27662517289074|Huang Ping, Sichu...|                   CH|20181201000000| 20181201000000|            scmp.com|-0.27662517289074|                         |     Eng|\n|    806755531|20181201|   201812|2018|      DEPUTY|                 |        WORKER|                 |          5|          5|               -4|                    |                     |20181201000000| 20181201081500|pressandjournal.c...|-4.47058823529411|                         |     Eng|\n|    806755531|20181201|   201812|2018|      DEPUTY|                 |        WORKER|                 |          5|          5|               -4|                    |                     |20181201000000| 20181201000000|    dailypioneer.com|               -4|                         |     Eng|\n|    806755750|20181201|   201812|2018|  UNIVERSITY|                 |              |                 |          8|          8| 1.60550458715597|Toronto, Ontario,...|                   CA|20181201000000| 20181201000000|       saultstar.com| 1.60550458715597|                         |     Eng|\n|    806756157|20181201|   201812|2018| AUTHORITIES|                 |              |                 |          1|          1|-1.00824931255728|         South Korea|                   KS|20181201000000| 20181201183000|           yahoo.com| -1.1031175059952|                         |     Eng|\n|    806756157|20181201|   201812|2018| AUTHORITIES|                 |              |                 |          1|          1|-1.00824931255728|         South Korea|                   KS|20181201000000| 20181201134500|           yahoo.com|-1.10683349374399|                         |     Eng|\n|    806756157|20181201|   201812|2018| AUTHORITIES|                 |              |                 |          1|          1|-1.00824931255728|         South Korea|                   KS|20181201000000| 20181201030000|   delphosherald.com|-1.00778744846541|                         |     Eng|\n|    806756157|20181201|   201812|2018| AUTHORITIES|                 |              |                 |          1|          1|-1.00824931255728|         South Korea|                   KS|20181201000000| 20181201154500| yorktonthisweek.com|-1.00824931255728|                         |     Eng|\n|    806756157|20181201|   201812|2018| AUTHORITIES|                 |              |                 |          1|          1|-1.00824931255728|         South Korea|                   KS|20181201000000| 20181201110000|     dailymail.co.uk|-1.43712574850299|                         |     Eng|\n|    806756157|20181201|   201812|2018| AUTHORITIES|                 |              |                 |          1|          1|-1.00824931255728|         South Korea|                   KS|20181201000000| 20181201010000|        inquirer.net|-1.65892501658925|                         |     Eng|\n|    806756157|20181201|   201812|2018| AUTHORITIES|                 |              |                 |          1|          1|-1.00824931255728|         South Korea|                   KS|20181201000000| 20181201071500|       firstpost.com|-1.12107623318386|                         |     Eng|\n+-------------+--------+---------+----+------------+-----------------+--------------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579004196824_-236829289","id":"20200111-163345_867293733","dateCreated":"2020-01-14T12:16:36+0000","dateStarted":"2020-01-15T21:04:24+0000","dateFinished":"2020-01-15T21:05:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:380"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579121127385_-1259749963","id":"20200115-204527_598648287","dateCreated":"2020-01-15T20:45:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2520","text":"event_mention_DF.filter(\"ActionGeo_CountryCode == 'US'\").distinct.show()","dateUpdated":"2020-01-15T21:04:08+0000","dateFinished":"2020-01-15T21:04:40+0000","dateStarted":"2020-01-15T21:04:08+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------+----+----------+-----------------+----------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\n|GLOBALEVENTID|     Day|MonthYear|Year|Actor1Name|Actor1CountryCode|Actor2Name|Actor2CountryCode|NumMentions|NumArticles|          AvgTone|  ActionGeo_FullName|ActionGeo_CountryCode| EventTimeDate|MentionTimeDate|   MentionSourceName|   MentionDocTone|MentionDocTranslationInfo|Langue_2|\n+-------------+--------+---------+----+----------+-----------------+----------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\n|    806754408|20181201|   201812|2018|          |                 |     VOTER|                 |          6|          6|-3.91061452513966|Broward County, F...|                   US|20181201000000| 20181201001500|        mynews13.com|-3.91061452513966|                         |     Eng|\n|    806754408|20181201|   201812|2018|          |                 |     VOTER|                 |          6|          6|-3.91061452513966|Broward County, F...|                   US|20181201000000| 20181201000000|        baynews9.com|-3.91061452513966|                         |     Eng|\n|    806755131|20181201|   201812|2018|  INDUSTRY|                 |  NEW YORK|              USA|         10|         10|  2.3121387283237|New York, United ...|                   US|20181201000000| 20181201054500|            wral.com| -1.0228166797797|                         |     Eng|\n|    806755131|20181201|   201812|2018|  INDUSTRY|                 |  NEW YORK|              USA|         10|         10|  2.3121387283237|New York, United ...|                   US|20181201000000| 20181201114500|    readingeagle.com| 0.69204152249135|                         |     Eng|\n|    806755131|20181201|   201812|2018|  INDUSTRY|                 |  NEW YORK|              USA|         10|         10|  2.3121387283237|New York, United ...|                   US|20181201000000| 20181201000000|     therealdeal.com|  2.3121387283237|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201013000| ccenterdispatch.com|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201043000|            wtop.com|-3.55029585798817|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201003000|            ktbs.com|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201164500|           chron.com|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201033000|            ktar.com| -3.6144578313253|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201020000| am1070theanswer.com|-3.52941176470588|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201213000|      timesunion.com|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201213000|          ctpost.com|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201093000|          nbcdfw.com|-3.57142857142857|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201160000|          sfgate.com|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201001500|brownsvilleherald...|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201051500|            wrex.com|-4.05405405405405|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201051500|    citynews1130.com|               -4|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201051500|     660citynews.com|               -4|                         |     Eng|\n|    806757087|20181201|   201812|2018|      ARMY|                 |    PRISON|                 |          1|          1|-4.05405405405405|San Antonio, Texa...|                   US|20181201000000| 20181201051500|            waow.com|-4.05405405405405|                         |     Eng|\n+-------------+--------+---------+----+----------+-----------------+----------+-----------------+-----------+-----------+-----------------+--------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\nonly showing top 20 rows\n\n"}]}},{"text":"val test= event_mention_DF.filter(\"ActionGeo_CountryCode == 'IN'\").groupBy(\"GLOBALEVENTID\",\"Day\").count().sort($\"count\".desc) // count number of articles per globaleventid\n\ntest.show","user":"anonymous","dateUpdated":"2020-01-15T21:09:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"test: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, Day: string ... 1 more field]\n+-------------+--------+-----+\n|GLOBALEVENTID|     Day|count|\n+-------------+--------+-----+\n|    806879584|20181201|  188|\n|    806881713|20181201|  140|\n|    806881719|20181201|  140|\n|    806759566|20181201|  120|\n|    806770610|20181201|   51|\n|    806761078|20181201|   45|\n|    806759571|20181201|   44|\n|    806784857|20181201|   43|\n|    806823721|20181201|   43|\n|    806823713|20181201|   43|\n|    806823834|20181201|   42|\n|    806823836|20181201|   40|\n|    806827271|20181201|   40|\n|    806761082|20181201|   39|\n|    806770343|20181201|   37|\n|    806827717|20181201|   36|\n|    806759876|20181201|   35|\n|    806810628|20181201|   34|\n|    806777208|20181201|   32|\n|    806783683|20181201|   32|\n+-------------+--------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579015376606_-1827165501","id":"20200114-152256_1289708062","dateCreated":"2020-01-14T15:22:56+0000","dateStarted":"2020-01-15T21:09:38+0000","dateFinished":"2020-01-15T21:09:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:381"},{"text":"val test2 = event_mention_DF.filter(\"GLOBALEVENTID == 806950263\")    //on regarde pour le GLOBALEVENTID 806950263 qui compte 45 mentions d'apres le tableau ci-dessus\ntest2.show\n","user":"anonymous","dateUpdated":"2020-01-15T20:39:58+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"test2: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, Day: string ... 17 more fields]\n+-------------+--------+---------+----+----------+-----------------+----------+-----------------+-----------+-----------+-----------------+------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\n|GLOBALEVENTID|     Day|MonthYear|Year|Actor1Name|Actor1CountryCode|Actor2Name|Actor2CountryCode|NumMentions|NumArticles|          AvgTone|ActionGeo_FullName|ActionGeo_CountryCode| EventTimeDate|MentionTimeDate|   MentionSourceName|   MentionDocTone|MentionDocTranslationInfo|Langue_2|\n+-------------+--------+---------+----+----------+-----------------+----------+-----------------+-----------+-----------+-----------------+------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201233000|        1310news.com|-3.64963503649635|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201233000|        abc22now.com|-3.78787878787878|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201233000|             ksl.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201233000|     foxillinois.com|-3.78787878787878|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|           chron.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|   westport-news.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|         thehour.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|           nbc24.com|-3.78787878787878|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|    mysanantonio.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|       lmtonline.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500| middletownpress.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|     myplainview.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|theintelligencer.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|   newschannel20.com|-3.78787878787878|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|             mrt.com|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|         nytimes.com|-7.36842105263158|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|beaumontenterpris...|-3.70370370370371|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|      nbcchicago.com| -3.7593984962406|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|    foxbaltimore.com|-3.78787878787878|                         |     Eng|\n|    806950263|20181201|   201812|2018|     NAVAL|                 |   BAHRAIN|              BHR|          4|          4|-3.70370370370371|           Bahrain|                   BA|20181201230000| 20181201234500|         570news.com|-3.64963503649635|                         |     Eng|\n+-------------+--------+---------+----+----------+-----------------+----------+-----------------+-----------+-----------+-----------------+------------------+---------------------+--------------+---------------+--------------------+-----------------+-------------------------+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579015787242_-1416873221","id":"20200114-152947_769664875","dateCreated":"2020-01-14T15:29:47+0000","dateStarted":"2020-01-15T20:39:58+0000","dateFinished":"2020-01-15T20:40:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:382"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579119407600_-533194610","id":"20200115-201647_183260547","dateCreated":"2020-01-15T20:16:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1727","text":"//question2\n\n//a ajouter à la fin de ton tableau mention pour remplacer Null par Eng dans la colonne MentionDoc TranslationInfo\n//.withColumn(\"Langue_1\", when (col(\"MentionDocTranslationInfo\") === \"\", \"Eng\").otherwise(col(\"MentionDocTranslationInfo\")))\n//.withColumn(\"Langue_2\", split($\"Langue_1\", \";\").getItem(0))\n//.drop($\"Langue_1\")\n\n//pour créer un DF pour mention avec une sélection de colonne (remplacer mentionDF par le nom de votre DF pour Mention)\nval mentionDF_selected = mentionDF.select(\"GLOBALEVENTID\",\"MentionTimeDate\")\n \n//pour créer un DF pour event avec une sélection de colonne (remplacer eventDF par le nom de votre DF pour Event)\nval eventDF_selected  = eventDF.select(\"GLOBALEVENTID\",\"Day\",\"MonthYear\",\"Year\",\"ActionGeo_FullName\",\"ActionGeo_CountryCode\") \n\n//pour créer ta table Event JOIN Mention ON GlobalEventID  -  on peut egalement commencer par le join et faire la selection des colonnes ensuites\nval event_mention_DF = eventDF_selected.join(mentionDF_selected,\"GlobalEventID\")\n\n//choisir soit ActionGeo_CountryCode soit ActionGeo_FullName\n// Df avec colonne dans l'ordre\nval event_mention_DF_ordered = event_mention_DF.select(\"ActionGeo_CountryCode\",\"Day\",\"MonthYear\",\"Year\",\"GLOBALEVENTID\",\"MentionTimeDate\")\nevent_mention_DF_ordered.show()\n","dateUpdated":"2020-01-15T21:27:22+0000","dateFinished":"2020-01-15T21:24:01+0000","dateStarted":"2020-01-15T21:23:45+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mentionDF_selected: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, MentionTimeDate: string]\neventDF_selected: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, Day: string ... 4 more fields]\nevent_mention_DF: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, Day: string ... 5 more fields]\nevent_mention_DF_ordered: org.apache.spark.sql.DataFrame = [ActionGeo_CountryCode: string, Day: string ... 4 more fields]\n+---------------------+--------+---------+----+-------------+---------------+\n|ActionGeo_CountryCode|     Day|MonthYear|Year|GLOBALEVENTID|MentionTimeDate|\n+---------------------+--------+---------+----+-------------+---------------+\n|                   US|20181201|   201812|2018|    806754408| 20181201001500|\n|                   US|20181201|   201812|2018|    806754408| 20181201000000|\n|                   UK|20181201|   201812|2018|    806755037| 20181201154500|\n|                   UK|20181201|   201812|2018|    806755037| 20181201000000|\n|                   US|20181201|   201812|2018|    806755131| 20181201054500|\n|                   US|20181201|   201812|2018|    806755131| 20181201114500|\n|                   US|20181201|   201812|2018|    806755131| 20181201000000|\n|                   CA|20181201|   201812|2018|    806755294| 20181201000000|\n|                   CH|20181201|   201812|2018|    806755371| 20181201060000|\n|                   CH|20181201|   201812|2018|    806755371| 20181201000000|\n|                     |20181201|   201812|2018|    806755531| 20181201081500|\n|                     |20181201|   201812|2018|    806755531| 20181201000000|\n|                   CA|20181201|   201812|2018|    806755750| 20181201000000|\n|                   KS|20181201|   201812|2018|    806756157| 20181201183000|\n|                   KS|20181201|   201812|2018|    806756157| 20181201134500|\n|                   KS|20181201|   201812|2018|    806756157| 20181201030000|\n|                   KS|20181201|   201812|2018|    806756157| 20181201154500|\n|                   KS|20181201|   201812|2018|    806756157| 20181201110000|\n|                   KS|20181201|   201812|2018|    806756157| 20181201010000|\n|                   KS|20181201|   201812|2018|    806756157| 20181201071500|\n+---------------------+--------+---------+----+-------------+---------------+\nonly showing top 20 rows\n\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579123644228_-345463688","id":"20200115-212724_1916326265","dateCreated":"2020-01-15T21:27:24+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3976","text":"//requete :  remplacer IN par un autre pays, \nval test= event_mention_DF_ordered.filter(\"ActionGeo_CountryCode == 'IN'\").groupBy(\"GLOBALEVENTID\",\"Day\").agg(\n    expr(\"count(MentionTimeDate) as Nombre_Article\")).sort($\"Nombre_Article\".desc) \n\n//reordonner les colonnes\nval test_ordered = test.select(\"GLOBALEVENTID\",\"Nombre_Article\",\"Day\")\n\ntest_ordered.show"},{"text":"%md A vous de jouer ! Utilisez la documentation GDELT(https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/) et commencez a explorer les donnees via les API Spark.","dateUpdated":"2020-01-14T12:16:36+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>A vous de jouer ! Utilisez la documentation GDELT(<a href=\"https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/\">https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/</a>) et commencez a explorer les donnees via les API Spark.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579004196825_-237214038","id":"20171218-084519_765381887","dateCreated":"2020-01-14T12:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:383"}],"name":"gdeltExploration (Local)","id":"2EXUBHEKH","angularObjects":{"2EZCQDYAE:shared_process":[],"2EZ4EKBKV:shared_process":[],"2EYEMC79P:shared_process":[],"2EWRQDZ3Y:shared_process":[],"2EXEEDGU8:shared_process":[],"2EY9BTJ13:shared_process":[],"2EZDQBW2S:shared_process":[],"2F1CCF16C:shared_process":[],"2EYNQMQK7:shared_process":[],"2EYJUHDF2:shared_process":[],"2EWT9KH5A:shared_process":[],"2EXMKK1ZD:shared_process":[],"2EXPQ5JCR:shared_process":[],"2EZXZKN2N:shared_process":[],"2EY5H33JF:shared_process":[],"2EXJKB758:shared_process":[],"2EZ1PCBP9:shared_process":[],"2EZTJW8ZQ:shared_process":[],"2EYHFQ9PS:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}