{"paragraphs":[{"text":"%md\n## Exploration des donnees GDELT via Spark\nDans ce notebook nous allons commencer a explorer les donnees GDELT qu'on a stoque sur S3","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Exploration des donnees GDELT via Spark</h2>\n<p>Dans ce notebook nous allons commencer a explorer les donnees GDELT qu&rsquo;on a stoque sur S3</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156745_551648920","id":"20181212-102323_67420128","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5334"},{"text":"val PROVIDER = \"org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider\"\nval AWS_ID =\"ASIA5SGH3P6KGBP4EHN2\"\nval AWS_KEY =\"bjs7QR3upuvHWxbkh0EJPuMnolbygn/JjfWXiu4K\"\n//val AWS_TOKEN=\"FwoGZXIvYXdzEEsaDFJaAcBgcnAW8e4dUSK/Ab+xlXjO+ZEuiqisQg+0SmZRiXO5nd+kVkL9nxB0/BbL5WcCRAsZEqghZuAmM+QU2DZ8vAXGPsrCaGrx6/C0MEeyoNjsNzUsecR2yO5lMKDoSTR7A5LYtNGhBiUwXa77bTQFU7Ky+xi+3HpTmLThdU49E8HzuDkGWV7MT4K6hPOQCRQuGyWcRVZ2ZYLTwgByA3w7wRxpP07rqTSSdEPg/iYCkbDRaQiy0WhypvRM5EYyz0A50ezWfqZTy1K5CG8sKN+HjfEFMi1Z5qjMABIINual7YClRF8iCtPs6BZRTzAzih3YxUAcDOBGL6djx3ODzBGC1/4=\"\n\n// la classe AmazonS3Client n'est pas serializable\n// on rajoute l'annotation @transient pour dire a Spark de ne pas essayer de serialiser cette classe et l'envoyer aux executeurs\n//@transient val awsClient = new AmazonS3Client(new BasicSessionCredentials(AWS_ID, AWS_KEY, AWS_TOKEN))\n\n//@transient val awsClient = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY,))/\n\n//sc.hadoopConfiguration.set(\"fs.s3a.aws.credentials.provider\", PROVIDER) //   pour AWSeducate , retirer si compte normal\n//sc.hadoopConfiguration.set(\"fs.s3a.awsAccesKeyId\", AWS_ID) // mettre votre ID du fichier credentials.csv\n\n\n\nsc.hadoopConfiguration.set(\"fs.s3.maxConnections\", \"1000\")\nsc.hadoopConfiguration.set(\"fs.s3a.maxConnections\", \"3000\")\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\n//sc.hadoopConfiguration.set(\"fs.s3a.awsSecretAccessKey\", AWS_KEY) // mettre votre secret du fichier credentials.csv\n//sc.hadoopConfiguration.set(\"fs.s3a.session.token\", AWS_TOKEN) //   pour AWSeducate , retirer si compte normal\n\n","user":"anonymous","dateUpdated":"2020-01-19T10:48:37+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"PROVIDER: String = org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider\nAWS_ID: String = ASIA5SGH3P6KGBP4EHN2\nAWS_KEY: String = bjs7QR3upuvHWxbkh0EJPuMnolbygn/JjfWXiu4K\n"}]},"apps":[],"jobName":"paragraph_1579420156750_973791652","id":"20171217-230735_1688540039","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T10:48:37+0000","dateFinished":"2020-01-19T10:48:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5335"},{"text":"%md\n### NOTES :  Remplacer s3a par s3  dans les liens pour acceder aux buckets","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>NOTES : Remplacer s3a par s3 dans les liens pour acceder aux buckets</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156750_-1714826495","id":"20200118-175712_2020921754","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5336"},{"text":"%md\n### EVENT","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579420156751_1004132603","id":"20200118-170725_2018393531","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5337"},{"text":"%md Les fichiers sont stoquees compresses, on a besoin d'un bout de code pour les decompresser en parallel sur les workers au fur et a mesure qu'on les lit depuis S3:","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Les fichiers sont stoquees compresses, on a besoin d&rsquo;un bout de code pour les decompresser en parallel sur les workers au fur et a mesure qu&rsquo;on les lit depuis S3:</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156751_-751370471","id":"20181212-102329_808049084","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5338"},{"text":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\n\n// 20181201000000.export.CSV.zip\n\n//exporter fichiers issus de masterfilelist.txt\nval textRDD_eng = sc.binaryFiles(\"s3://hiroto-yamakawq-gdelt2019/20181201[0-9]*.export.CSV.zip\"). // charger quelques fichers via une regex   \n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n    \n//exporter fichiers issus de masterfilelist-translation.txt\nval textRDD_translate = sc.binaryFiles(\"s3://hiroto-yamakawq-gdelt2019/20181201[0-9]*.translation.export.CSV.zip\"). \n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n    \n\n//concaténer les RDD et transformer en DataFrame                           //Pour des raisons de cohérence, nous indiquons ici le nom des colonnes comme indiqué dans la documentation GDELT. Nous les renommerons lorsque nécessaire plus bas\nval eventDF = textRDD_eng.union(textRDD_translate).toDF()\n.withColumn(\"GLOBALEVENTID\", split($\"value\", \"\\\\t\").getItem(0))\n.withColumn(\"Day\", split($\"value\", \"\\\\t\").getItem(1))\n.withColumn(\"MonthYear\", split($\"value\", \"\\\\t\").getItem(2))\n.withColumn(\"Year\", split($\"value\", \"\\\\t\").getItem(3))\n.withColumn(\"FractionDate\", split($\"value\", \"\\\\t\").getItem(4))\n.withColumn(\"Actor1Code\", split($\"value\", \"\\\\t\").getItem(5))\n.withColumn(\"Actor1Name\", split($\"value\", \"\\\\t\").getItem(6))\n.withColumn(\"Actor1CountryCode\", split($\"value\", \"\\\\t\").getItem(7))\n.withColumn(\"Actor1KnownGroupCode\", split($\"value\", \"\\\\t\").getItem(8))\n.withColumn(\"Actor1EthnicCode\", split($\"value\", \"\\\\t\").getItem(9))\n.withColumn(\"Actor1Religion1Code\", split($\"value\", \"\\\\t\").getItem(10))\n.withColumn(\"Actor1Religion2Code\", split($\"value\", \"\\\\t\").getItem(11))\n.withColumn(\"Actor1Type1Code\", split($\"value\", \"\\\\t\").getItem(12))\n.withColumn(\"Actor1Type2Code\", split($\"value\", \"\\\\t\").getItem(13))\n.withColumn(\"Actor1Type3Code\", split($\"value\", \"\\\\t\").getItem(14))\n.withColumn(\"Actor2Code\", split($\"value\", \"\\\\t\").getItem(15))\n.withColumn(\"Actor2Name\", split($\"value\", \"\\\\t\").getItem(16))\n.withColumn(\"Actor2CountryCode\", split($\"value\", \"\\\\t\").getItem(17))\n.withColumn(\"Actor2KnownGroupCode\", split($\"value\", \"\\\\t\").getItem(18))\n.withColumn(\"Actor2EthnicCode\", split($\"value\", \"\\\\t\").getItem(19))\n.withColumn(\"Actor2Religion1Code\", split($\"value\", \"\\\\t\").getItem(20))\n.withColumn(\"Actor2Religion2Code\", split($\"value\", \"\\\\t\").getItem(21))\n.withColumn(\"Actor2Type1Code\", split($\"value\", \"\\\\t\").getItem(22))\n.withColumn(\"Actor2Type2Code\", split($\"value\", \"\\\\t\").getItem(23))\n.withColumn(\"Actor2Type3Code\", split($\"value\", \"\\\\t\").getItem(24))\n.withColumn(\"IsRootEvent\", split($\"value\", \"\\\\t\").getItem(25))\n.withColumn(\"EventCode\", split($\"value\", \"\\\\t\").getItem(26))\n.withColumn(\"EventBaseCode\", split($\"value\", \"\\\\t\").getItem(27))\n.withColumn(\"EventRootCode\", split($\"value\", \"\\\\t\").getItem(28))\n.withColumn(\"QuadClass\", split($\"value\", \"\\\\t\").getItem(29))\n.withColumn(\"GoldsteinScale\", split($\"value\", \"\\\\t\").getItem(30))\n.withColumn(\"NumMentions\", split($\"value\", \"\\\\t\").getItem(31))\n.withColumn(\"NumSources\", split($\"value\", \"\\\\t\").getItem(32))\n.withColumn(\"NumArticles\", split($\"value\", \"\\\\t\").getItem(33))\n.withColumn(\"AvgTone\", split($\"value\", \"\\\\t\").getItem(34))\n.withColumn(\"Actor1Geo_Type\", split($\"value\", \"\\\\t\").getItem(35))\n.withColumn(\"Actor1Geo_FullName\", split($\"value\", \"\\\\t\").getItem(36))\n.withColumn(\"Actor1Geo_CountryCode\", split($\"value\", \"\\\\t\").getItem(37))\n.withColumn(\"Actor1Geo_ADM1Code\", split($\"value\", \"\\\\t\").getItem(38))\n.withColumn(\"Actor1Geo_ADM2Code\", split($\"value\", \"\\\\t\").getItem(39))\n.withColumn(\"Actor1Geo_Lat\", split($\"value\", \"\\\\t\").getItem(40))\n.withColumn(\"Actor1Geo_Long\", split($\"value\", \"\\\\t\").getItem(41))\n.withColumn(\"Actor1Geo_FeatureID\", split($\"value\", \"\\\\t\").getItem(42))\n.withColumn(\"Actor2Geo_Type\", split($\"value\", \"\\\\t\").getItem(43))\n.withColumn(\"Actor2Geo_FullName\", split($\"value\", \"\\\\t\").getItem(44))\n.withColumn(\"Actor2Geo_CountryCode\", split($\"value\", \"\\\\t\").getItem(45))\n.withColumn(\"Actor2Geo_ADM1Code\", split($\"value\", \"\\\\t\").getItem(46))\n.withColumn(\"Actor2Geo_ADM2Code\", split($\"value\", \"\\\\t\").getItem(47))\n.withColumn(\"Actor2Geo_Lat\", split($\"value\", \"\\\\t\").getItem(48))\n.withColumn(\"Actor2Geo_Long\", split($\"value\", \"\\\\t\").getItem(49))\n.withColumn(\"Actor2Geo_FeatureID\", split($\"value\", \"\\\\t\").getItem(50))\n.withColumn(\"ActionGeo_Type\", split($\"value\", \"\\\\t\").getItem(51))\n.withColumn(\"ActionGeo_FullName\", split($\"value\", \"\\\\t\").getItem(52))\n.withColumn(\"ActionGeo_CountryCode\", split($\"value\", \"\\\\t\").getItem(53))\n.withColumn(\"ActionGeo_ADM1Code\", split($\"value\", \"\\\\t\").getItem(54))\n.withColumn(\"ActionGeo_ADM2Code\", split($\"value\", \"\\\\t\").getItem(55))\n.withColumn(\"ActionGeo_Lat\", split($\"value\", \"\\\\t\").getItem(56))\n.withColumn(\"ActionGeo_Long\", split($\"value\", \"\\\\t\").getItem(57))\n.withColumn(\"ActionGeo_FeatureID\", split($\"value\", \"\\\\t\").getItem(58))\n.withColumn(\"DATEADDED\", split($\"value\", \"\\\\t\").getItem(59))\n.withColumn(\"SOURCEURL\", split($\"value\", \"\\\\t\").getItem(60))\n.drop($\"value\")\n\n","user":"anonymous","dateUpdated":"2020-01-19T07:50:58+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\ntextRDD_eng: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[1] at flatMap at <console>:34\ntextRDD_translate: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[3] at flatMap at <console>:47\neventDF: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, Day: string ... 59 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579420156751_-612162850","id":"20171217-232457_1732696781","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T07:50:58+0000","dateFinished":"2020-01-19T07:51:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5339"},{"text":"%md\n### GLOBAL KNOWLEDGE GRAPH","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>GLOBAL KNOWLEDGE GRAPH</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156751_128169492","id":"20200118-170130_892217168","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5340"},{"text":"//exporter fichiers issus de masterfilelist.txt\nval gkgRDD_eng = sc.binaryFiles(\"s3://hiroto-yamakawq-gdelt2019/20181201[0-9]*.gkg.csv.zip\"). // charger quelques fichers via une regex   \n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n\n//exporter fichiers issus de masterfilelist-translation.txt\nval gkgRDD_translate = sc.binaryFiles(\"s3://hiroto-yamakawq-gdelt2019/20181201[0-9]*.translation.gkg.csv.zip\").  \n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n    \n//concaténer les RDD et transformer en DataFrame                                    \nval gkgDF = gkgRDD_eng.union(gkgRDD_translate).toDF()\n.withColumn(\"GKGRECORDID\", split($\"value\", \"\\\\t\").getItem(0))\n.withColumn(\"DATE\", split($\"value\", \"\\\\t\").getItem(1))\n.withColumn(\"SourceCollectionIdentifier\", split($\"value\", \"\\\\t\").getItem(2))\n.withColumn(\"SourceCommonName\", split($\"value\", \"\\\\t\").getItem(3))\n.withColumn(\"DocumentIdentifier\", split($\"value\", \"\\\\t\").getItem(4))\n.withColumn(\"Counts\", split($\"value\", \"\\\\t\").getItem(5))\n.withColumn(\"V2Counts\", split($\"value\", \"\\\\t\").getItem(6))\n.withColumn(\"Themes\", split($\"value\", \"\\\\t\").getItem(7))\n.withColumn(\"V2Themes\", split($\"value\", \"\\\\t\").getItem(8))\n.withColumn(\"Locations\", split($\"value\", \"\\\\t\").getItem(9))\n.withColumn(\"V2Locations\", split($\"value\", \"\\\\t\").getItem(10))\n.withColumn(\"Persons\", split($\"value\", \"\\\\t\").getItem(11))\n.withColumn(\"V2Persons\", split($\"value\", \"\\\\t\").getItem(12))\n.withColumn(\"Organizations\", split($\"value\", \"\\\\t\").getItem(13))\n.withColumn(\"V2Organizations\", split($\"value\", \"\\\\t\").getItem(14))\n.withColumn(\"V2Tone\", split($\"value\", \"\\\\t\").getItem(15))\n.withColumn(\"Dates\", split($\"value\", \"\\\\t\").getItem(16))\n.withColumn(\"GCAM\", split($\"value\", \"\\\\t\").getItem(17))\n.withColumn(\"SharingImage\", split($\"value\", \"\\\\t\").getItem(18))\n.withColumn(\"RelatedImages\", split($\"value\", \"\\\\t\").getItem(19))\n.withColumn(\"SocialImageEmbeds\", split($\"value\", \"\\\\t\").getItem(20))\n.withColumn(\"SocialVideoEmbeds\", split($\"value\", \"\\\\t\").getItem(21))\n.withColumn(\"Quotations\", split($\"value\", \"\\\\t\").getItem(22))\n.withColumn(\"AllNames\", split($\"value\", \"\\\\t\").getItem(23))\n.withColumn(\"Amounts\", split($\"value\", \"\\\\t\").getItem(24))\n.withColumn(\"TranslationInfo\", split($\"value\", \"\\\\t\").getItem(25))\n.withColumn(\"Extras\", split($\"value\", \"\\\\t\").getItem(26))\n.drop($\"value\")","user":"anonymous","dateUpdated":"2020-01-19T10:48:45+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"gkgRDD_eng: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[312] at flatMap at <console>:34\ngkgRDD_translate: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[314] at flatMap at <console>:47\ngkgDF: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, DATE: string ... 25 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579420156752_-2002947823","id":"20200118-170907_2089007112","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T10:48:45+0000","dateFinished":"2020-01-19T10:49:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5341"},{"text":"%md\n### MENTION ","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579420156752_-655252981","id":"20200118-170957_1173975364","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5342"},{"text":"//exporter fichiers issus de masterfilelist.txt\nval mentionRDD_eng = sc.binaryFiles(\"s3://hiroto-yamakawq-gdelt2019/20181201[0-9]*.mentions.CSV.zip\").   \n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n    \n//exporter fichiers issus de masterfilelist-translation.txt\nval mentionRDD_translate = sc.binaryFiles(\"s3://hiroto-yamakawq-gdelt2019/20181201[0-9]*.translation.mentions.CSV.zip\"). \n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\n    \n//concaténer les RDD et transformer en DataFrame\nval mentionDF = mentionRDD_eng.union(mentionRDD_translate).toDF()\n.withColumn(\"GLOBALEVENTID\", split($\"value\", \"\\\\t\").getItem(0))\n.withColumn(\"EventTimeDate\", split($\"value\", \"\\\\t\").getItem(1))\n.withColumn(\"MentionTimeDate\", split($\"value\", \"\\\\t\").getItem(2))\n.withColumn(\"MentionType\", split($\"value\", \"\\\\t\").getItem(3))\n.withColumn(\"MentionSourceName\", split($\"value\", \"\\\\t\").getItem(4))\n.withColumn(\"MentionIdentifier\", split($\"value\", \"\\\\t\").getItem(5))\n.withColumn(\"SentenceID\", split($\"value\", \"\\\\t\").getItem(6))\n.withColumn(\"Actor1CharOffset\", split($\"value\", \"\\\\t\").getItem(7))\n.withColumn(\"Actor2CharOffset\", split($\"value\", \"\\\\t\").getItem(8))\n.withColumn(\"ActionCharOffset\", split($\"value\", \"\\\\t\").getItem(9))\n.withColumn(\"InRawText\", split($\"value\", \"\\\\t\").getItem(10))\n.withColumn(\"Confidence\", split($\"value\", \"\\\\t\").getItem(11))\n.withColumn(\"MentionDocLen\", split($\"value\", \"\\\\t\").getItem(12))\n.withColumn(\"MentionDocTone\", split($\"value\", \"\\\\t\").getItem(13))\n.withColumn(\"MentionDocTranslationInfo\", split($\"value\", \"\\\\t\").getItem(14))\n.withColumn(\"Extras\", split($\"value\", \"\\\\t\").getItem(15))\n.withColumn(\"Langue_1\", when (col(\"MentionDocTranslationInfo\") === \"\", \":eng\").otherwise(col(\"MentionDocTranslationInfo\")))    /// les lignes suivante concernent la Tramsformation de la colonne MentionDocTranslationInfo\n.withColumn(\"Langue_2\", split($\"Langue_1\", \";\").getItem(0))\n.withColumn(\"Langue\", split($\"Langue_2\", \":\").getItem(1))\n.drop($\"Langue_1\")\n.drop($\"Langue_2\")\n.drop($\"value\")\n//.drop($\"MentionDocTranslationInfo\")  à supprimer une fois le groupe convaincu que la transformation de la colonne fonctionne\n","user":"anonymous","dateUpdated":"2020-01-19T07:52:00+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mentionRDD_eng: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[11] at flatMap at <console>:31\nmentionRDD_translate: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[13] at flatMap at <console>:44\nmentionDF: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, EventTimeDate: string ... 15 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579420156752_1461071595","id":"20200118-171001_883950930","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T07:52:00+0000","dateFinished":"2020-01-19T07:52:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5343"},{"text":"mentionDF.select(\"MentionDocTranslationInfo\",\"Langue\").distinct.cache().show()      // piste d'amélioration : trouver ou créer un dico key/value pour remplacer le sigle par la langue full name   . De Mëme pour les pays","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------------+------+\n|MentionDocTranslationInfo|Langue|\n+-------------------------+------+\n|     srclc:dan;eng:GT-...|   dan|\n|     srclc:swe;eng:GT-...|   swe|\n|     srclc:ces;eng:Mos...|   ces|\n|     srclc:spa;eng:Mos...|   spa|\n|     srclc:kat;eng:GT-...|   kat|\n|     srclc:tur;eng:GT-...|   tur|\n|     srclc:urd;eng:GT-...|   urd|\n|     srclc:rus;eng:GT-...|   rus|\n|     srclc:est;eng:Mos...|   est|\n|     srclc:som;eng:GT-...|   som|\n|     srclc:ita;eng:GT-...|   ita|\n|     srclc:nld;eng:GT-...|   nld|\n|     srclc:lit;eng:GT-...|   lit|\n|     srclc:bul;eng:GT-...|   bul|\n|     srclc:ben;eng:GT-...|   ben|\n|     srclc:tel;eng:GT-...|   tel|\n|     srclc:spa;eng:GT-...|   spa|\n|     srclc:hrv;eng:GT-...|   hrv|\n|     srclc:fra;eng:GT-...|   fra|\n|     srclc:fas;eng:GT-...|   fas|\n+-------------------------+------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579420156752_-852759424","id":"20200118-171218_302028850","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5344"},{"text":"// on réduit d'abord le nombre de colonnes sur chaque DF avant d'effectuer le join pour améliorer les performances \n\nval eventDF_selected  = eventDF.select(\"GLOBALEVENTID\",\"Day\",\"MonthYear\",\"Year\",\"Actor1Name\",\"Actor1CountryCode\",\"Actor2Name\",\"Actor2CountryCode\",\"NumMentions\",\"NumArticles\",\"AvgTone\",\"ActionGeo_FullName\",\"ActionGeo_CountryCode\").cache()\n\nval gkgDF_selected = gkgDF.select(\"GKGRECORDID\",\"DATE\",\"SourceCommonName\",\"DocumentIdentifier\",\"Themes\",\"Locations\",\"Persons\",\"V2Themes\",\"V2Locations\",\"V2Persons\",\"Organizations\",\"V2Tone\",\"TranslationInfo\").cache()\n\nval mentionDF_selected = mentionDF.select(\"GLOBALEVENTID\",\"EventTimeDate\",\"MentionTimeDate\",\"MentionSourceName\",\"MentionIdentifier\",\"MentionDocTone\",\"MentionDocTranslationInfo\",\"Langue\").cache()\n\n \n//JOIN eventDF_selected with mentionDF_selected ON GLOBALEVENTID   \nval event_mention_DF = eventDF_selected.join(mentionDF_selected,\"GlobalEventID\").cache()       // is the .cache() effective here? TBC\n\n//JOIN gkgDF_selected with mentionDF_selected ON DocumentIdentifier = MentionIdentifier \nval mention_gkg_DF = mentionDF_selected.join(gkgDF_selected, mentionDF_selected(\"MentionIdentifier\") ===  gkgDF_selected(\"DocumentIdentifier\")).cache()\n\n//JOIN eventDF_selected with mention_gkg_DF ON GLOBALEVENTID \nval event_mention_gkg_DF = mention_gkg_DF.join(eventDF_selected,\"GlobalEventID\").cache()","user":"anonymous","dateUpdated":"2020-01-19T07:52:10+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"eventDF_selected: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, Day: string ... 11 more fields]\ngkgDF_selected: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GKGRECORDID: string, DATE: string ... 11 more fields]\nmentionDF_selected: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, EventTimeDate: string ... 6 more fields]\nevent_mention_DF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, Day: string ... 18 more fields]\nmention_gkg_DF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, EventTimeDate: string ... 19 more fields]\nevent_mention_gkg_DF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, EventTimeDate: string ...."}]},"apps":[],"jobName":"paragraph_1579420156752_-677865448","id":"20200118-171245_1235177400","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T07:52:18+0000","dateFinished":"2020-01-19T07:52:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5345"},{"text":"%md\n### REQUETES","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>REQUETES</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156753_-1715248793","id":"20200118-171317_1531636705","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5346"},{"text":"%md\n### 1) afficher le nombre d’articles/évènements qu’il y a eu pour chaque triplet (jour, pays de l’évènement, langue de l’article).","user":"anonymous","dateUpdated":"2020-01-19T13:36:49+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579420156753_1009508423","id":"20200118-171340_1397000236","dateCreated":"2020-01-19T07:49:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5347","dateFinished":"2020-01-19T13:36:49+0000","dateStarted":"2020-01-19T13:36:49+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>1) afficher le nombre d’articles/évènements qu’il y a eu pour chaque triplet (jour, pays de l’évènement, langue de l’article).</h3>\n</div>"}]}},{"text":"//FONCTION pour couper DATE en Year,month,day\n\nval slice = udf((string : String, from : Int, to : Int) => string.slice(from,to))\n\nval test = event_mention_DF.select(\"ActionGeo_CountryCode\",\"DATE\",\"DocumentIdentifier\",\"V2Persons\",\"V2Tone\")\n.withColumn(\"YEAR\", slice($\"Day\",lit(0),lit(4)))\n.withColumn(\"MONTH\", slice($\"Day\",lit(4),lit(6)))\n.withColumn(\"DAY\", slice($\"Day\",lit(6),lit(8)))\n.drop($\"Day\")","user":"anonymous","dateUpdated":"2020-01-19T13:24:08+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579440144832_-1119277210","id":"20200119-132224_693192395","dateCreated":"2020-01-19T13:22:24+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10893"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579445701159_877409619","id":"20200119-145501_723585665","dateCreated":"2020-01-19T14:55:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:12559","text":"val question1Df = event_mention_DF\n.filter($\"ActionGeo_CountryCode\" !== \"\")\n.groupBy(\"ActionGeo_CountryCode\", \"Day\", \"Langue\",\"GLOBALEVENTID\")\n.agg(countDistinct($\"MentionIdentifier\") as \"distinct_count\") \n.withColumn(\"YEAR\", slice($\"Day\",lit(0),lit(4)))\n.withColumn(\"MONTH\", slice($\"Day\",lit(4),lit(6)))\n.withColumn(\"DAY\", slice($\"Day\",lit(6),lit(8)))\n.drop($\"Day\")\n\nval question1DfFinal = question1Df.select(\"DAY\",\"MONTH\",\"YEAR\",\"ActionGeo_CountryCode\",\"Langue\",\"GLOBALEVENTID\",\"distinct_count\")\n.withColumnRenamed(\"DAY\", \"jour\")\n.withColumnRenamed(\"MONTH\", \"mois\")\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"ActionGeo_CountryCode\", \"pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"Langue\", \"langue_article\")\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\n.sort($\"jour\".asc)                                                                                                              // WHY SEVERAL DAY ?? I thought we only had one day of data\n\nquestion1DfFinal.show()","dateUpdated":"2020-01-19T14:56:10+0000","dateFinished":"2020-01-19T14:56:11+0000","dateStarted":"2020-01-19T14:56:10+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\n+----+----+-----+----+--------------+---------+--------------+\n|jour|mois|annee|pays|langue_article|evenement|nombre_article|\n+----+----+-----+----+--------------+---------+--------------+\n|  01|  12| 2018|  CH|           eng|806754377|             1|\n|  01|  12| 2018|  US|           eng|806754559|            17|\n|  01|  12| 2018|  AS|           eng|806755380|             1|\n|  01|  12| 2018|  US|           eng|806755836|             1|\n|  01|  12| 2018|  FR|           eng|806755899|           214|\n|  01|  12| 2018|  FR|           spa|806755899|             9|\n|  01|  12| 2018|  GH|           eng|806756070|             1|\n|  01|  12| 2018|  FR|           eng|806756282|            15|\n|  01|  12| 2018|  US|           eng|806756324|            28|\n|  01|  12| 2018|  NI|           eng|806756464|             1|\n|  01|  12| 2018|  IS|           eng|806757249|             2|\n|  01|  12| 2018|  US|           eng|806757773|             8|\n|  01|  12| 2018|  US|           eng|806757975|             5|\n|  01|  12| 2018|  US|           eng|806758035|             1|\n|  01|  12| 2018|  US|           eng|806758135|             1|\n|  01|  12| 2018|  US|           eng|806758358|             2|\n|  01|  12| 2018|  US|           eng|806758576|            42|\n|  01|  12| 2018|  US|           eng|806758637|             1|\n|  01|  12| 2017|  AR|           eng|806759334|            47|\n|  01|  12| 2018|  RP|           eng|806759688|             1|\n+----+----+-----+----+--------------+---------+--------------+\nonly showing top 20 rows\n\nquestion1Df: org.apache.spark.sql.DataFrame = [ActionGeo_CountryCode: string, DAY: string ... 5 more fields]\nquestion1DfFinal: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [jour: string, mois: string ... 5 more fields]\n"}]}},{"text":"\n//CASSANDRA\nquestion1DfFinal.write.option(\"header\", \"true\").csv(\"s3a://hiroto-yamakawq-gdelt2019/question_1_clean.csv\")\n//question1DfFinal.write.cassandraFormat(\"table\", \"gdelt\").save()","user":"anonymous","dateUpdated":"2020-01-19T14:56:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\n+---------------------+--------+------+-------------+--------------+\n|ActionGeo_CountryCode|     Day|Langue|GLOBALEVENTID|distinct_count|\n+---------------------+--------+------+-------------+--------------+\n|                   US|20181201|   eng|    806800959|          1117|\n|                   US|20181201|   eng|    806754650|           952|\n|                   US|20181201|   eng|    806757901|           902|\n|                   US|20181201|   eng|    806757889|           870|\n|                   US|20181201|   eng|    806757864|           812|\n|                   US|20181201|   eng|    806757704|           784|\n|                   IR|20181201|   eng|    806829379|           647|\n|                   IR|20181201|   eng|    806829257|           647|\n|                   US|20181201|   eng|    806757863|           631|\n|                   FR|20181201|   eng|    806849161|           582|\n|                   US|20181201|   eng|    806818336|           547|\n|                   FR|20181201|   eng|    806837068|           546|\n|                   AR|20181201|   eng|    806754811|           538|\n|                   FR|20181201|   eng|    806836065|           534|\n|                   MX|20181201|   eng|    806769030|           526|\n|                   US|20181201|   eng|    806818353|           525|\n|                   MX|20181201|   eng|    806818335|           524|\n|                   US|20181201|   eng|    806818354|           523|\n|                   US|20181201|   eng|    806820357|           520|\n|                   US|20181201|   eng|    806757970|           504|\n+---------------------+--------+------+-------------+--------------+\nonly showing top 20 rows\n\nquestion1Dfbis_countdistinct: Unit = ()\n"}]},"apps":[],"jobName":"paragraph_1579420156753_1154256485","id":"20200118-171342_1526283639","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5348"},{"text":"//Justification\n\nval question1Dfbis_countdistinct = event_mention_DF\n.filter($\"ActionGeo_CountryCode\" !== \"\")\n.groupBy(\"ActionGeo_CountryCode\", \"Day\", \"Langue\",\"GLOBALEVENTID\")\n.agg(countDistinct($\"MentionIdentifier\") as \"distinct_count\")   //regarder la difference avec count() ci dessous  \n.sort($\"distinct_count\".desc)\n.show()\n\n\nval question1Dfbis_count = event_mention_DF\n.filter($\"ActionGeo_CountryCode\" !== \"\")\n.groupBy(\"ActionGeo_CountryCode\", \"Day\", \"Langue\",\"GLOBALEVENTID\")\n.count()   \n.sort($\"count\".desc)\n.show()                                                  // on voit que les valeurs de la colonne count est ici beaucoup plus eleve que dans la colonne distinct_count au dessus.  Pourquoi ? Reponse dans la requete ci-dessous\n\n\n//C'est parcequ'un evenement peut etre mentionne plusieurs fois dans un meme article comme le montre la requete suivante, ce qui fausse le resultat \n//il faudra donc faire un count distinct sur \"Mentionidentifier\" pour compter le nombre d'articles et pas le nombres de mentions\n\nval mention_par_event_df = event_mention_DF.groupBy(\"GLOBALEVENTID\",\"MentionIdentifier\").count().sort($\"count\".desc).show() ","user":"anonymous","dateUpdated":"2020-01-19T14:55:47+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579420156753_912159047","id":"20200118-171343_128590321","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5349"},{"text":"%md \n### 2) Pour un pays donné en paramètre, affichez les évènements qui y ont eu place triées par le nombre de mentions (tri décroissant); permettez une agrégation par jour/mois/année","user":"anonymous","dateUpdated":"2020-01-19T07:58:54+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>2) Pour un pays donné en paramètre, affichez les évènements qui y ont eu place triées par le nombre de mentions (tri décroissant); permettez une agrégation par jour/mois/année</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156754_746581814","id":"20200118-171548_564900489","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T07:58:54+0000","dateFinished":"2020-01-19T07:58:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5353"},{"text":"//choisir soit ActionGeo_CountryCode soit ActionGeo_FullName\n// Df avec colonne dans l'ordre\nval question2Df = event_mention_DF.select(\"ActionGeo_CountryCode\",\"Day\",\"MonthYear\",\"Year\",\"GLOBALEVENTID\")   //peut être que MentionTimeDate n'est pas nécessaire mais pratique pour distinguer les mentions pour un même event\n.filter($\"ActionGeo_CountryCode\" !== \"\")\n.groupBy(\"ActionGeo_CountryCode\",\"Day\",\"MonthYear\",\"Year\",\"GLOBALEVENTID\")\n.count()                                                                                                    //ici on veut le nombre de mentions et pas le nombre d'articles, donc .count() est correct\n.withColumn(\"DAY\", slice($\"Day\",lit(6),lit(8)))\n.withColumn(\"MONTH\", slice($\"MonthYear\",lit(4),lit(6)))                                                    \n.drop($\"Day\")\n.drop($\"MonthYear\") \n//.show()\n\n\nval question2DfFinal = question2Df.select(\"ActionGeo_CountryCode\",\"DAY\",\"MONTH\",\"Year\",\"GLOBALEVENTID\")\n.withColumnRenamed(\"DAY\", \"jour\")\n.withColumnRenamed(\"MONTH\", \"mois\")\n.withColumnRenamed(\"Year\", \"annee\")\n.withColumnRenamed(\"ActionGeo_CountryCode\", \"pays\")\n.withColumnRenamed(\"count\", \"nombre_mentions\")\n.sort($\"GLOBALEVENTID\".desc) \n\nquestion2DfFinal.show()","user":"anonymous","dateUpdated":"2020-01-19T13:37:31+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\n+----+----+----+-----+-------------+\n|pays|jour|mois|annee|GLOBALEVENTID|\n+----+----+----+-----+-------------+\n|  IR|  01|  12| 2018|    806958356|\n|  VT|  01|  12| 2018|    806958355|\n|  SP|  01|  12| 2018|    806958354|\n|  VE|  01|  12| 2018|    806958353|\n|  BA|  01|  12| 2018|    806958352|\n|  RS|  01|  12| 2018|    806958351|\n|  RS|  01|  12| 2018|    806958350|\n|  US|  01|  12| 2018|    806958349|\n|  US|  01|  12| 2018|    806958348|\n|  US|  01|  12| 2018|    806958347|\n|  UP|  01|  12| 2018|    806958346|\n|  US|  01|  12| 2018|    806958345|\n|  UP|  01|  12| 2018|    806958344|\n|  GM|  01|  12| 2018|    806958343|\n|  US|  01|  12| 2018|    806958342|\n|  US|  01|  12| 2018|    806958341|\n|  US|  01|  12| 2018|    806958340|\n|  UP|  01|  12| 2018|    806958339|\n|  GM|  01|  12| 2018|    806958338|\n|  SP|  01|  12| 2018|    806958337|\n+----+----+----+-----+-------------+\nonly showing top 20 rows\n\nquestion2Df: org.apache.spark.sql.DataFrame = [ActionGeo_CountryCode: string, DAY: string ... 4 more fields]\nquestion2DfFinal: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [pays: string, jour: string ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579420156754_428927386","id":"20200118-171548_1114384575","dateCreated":"2020-01-19T07:49:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5354","dateFinished":"2020-01-19T13:36:15+0000","dateStarted":"2020-01-19T13:36:14+0000"},{"text":"//essai\nval q2= question2DfFinal.filter(\"ActionGeo_CountryCode == 'US'\").show()","user":"anonymous","dateUpdated":"2020-01-19T13:36:29+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+----+----+-----+-------------+\n|pays|jour|mois|annee|GLOBALEVENTID|\n+----+----+----+-----+-------------+\n|  US|  01|  12| 2018|    806958349|\n|  US|  01|  12| 2018|    806958348|\n|  US|  01|  12| 2018|    806958347|\n|  US|  01|  12| 2018|    806958345|\n|  US|  01|  12| 2018|    806958342|\n|  US|  01|  12| 2018|    806958341|\n|  US|  01|  12| 2018|    806958340|\n|  US|  01|  12| 2018|    806958309|\n|  US|  01|  12| 2018|    806958303|\n|  US|  01|  12| 2018|    806958299|\n|  US|  01|  12| 2018|    806958298|\n|  US|  01|  12| 2018|    806958258|\n|  US|  01|  12| 2018|    806958255|\n|  US|  01|  12| 2018|    806958249|\n|  US|  01|  12| 2018|    806958233|\n|  US|  01|  12| 2018|    806958232|\n|  US|  01|  12| 2018|    806958226|\n|  US|  01|  12| 2018|    806958195|\n|  US|  01|  12| 2018|    806958185|\n|  US|  01|  12| 2018|    806958184|\n+----+----+----+-----+-------------+\nonly showing top 20 rows\n\nq2: Unit = ()\n"}]},"apps":[],"jobName":"paragraph_1579420156755_609303771","id":"20200118-171548_1975031412","dateCreated":"2020-01-19T07:49:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5355","dateFinished":"2020-01-19T13:36:30+0000","dateStarted":"2020-01-19T13:36:29+0000"},{"text":"//CASSANDRA\nquestion2DfFinal.write.option(\"header\", \"true\").csv(\"/zeppelin/tmp/question_2_clean.csv\")","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579420156755_1121588406","id":"20200118-171548_1559068102","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5356"},{"text":"//test\n//requete :  remplacer IN par un autre pays,   // count number of articles per globaleventid\nval q2= question2Df.filter(\"ActionGeo_CountryCode == 'IN'\").groupBy(\"GLOBALEVENTID\",\"Day\").agg(\n    expr(\"count(MentionTimeDate) as Nombre_Article\")).sort($\"Nombre_Article\".desc) \n\n//reordonner les colonnes\nval test_ordered = q2.select(\"GLOBALEVENTID\",\"Nombre_Article\",\"Day\")\ntest_ordered.show\n","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579420156755_-219158600","id":"20200118-171548_485472345","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5357"},{"text":"%md\n### 3) Pour une source de donnés passée en paramètre (gkg.SourceCommonName) affichez les thèmes, personnes, lieux dont les articles de cette sources parlent ainsi que le nombre d’articles et le ton moyen des articles (pour chaque thème/personne/lieu); permettez une agrégation par jour/mois/année.","user":"anonymous","dateUpdated":"2020-01-19T08:30:43+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>3) Pour une source de donnés passée en paramètre (gkg.SourceCommonName) affichez les thèmes, personnes, lieux dont les articles de cette sources parlent ainsi que le nombre d’articles et le ton moyen des articles (pour chaque thème/personne/lieu); permettez une agrégation par jour/mois/année.</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156755_-538131366","id":"20200118-171547_1094664052","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T08:30:43+0000","dateFinished":"2020-01-19T08:30:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5358"},{"text":"//FONCTION pour couper DATE en Year,month,day\n\nval slice = udf((string : String, from : Int, to : Int) => string.slice(from,to))\n\n\n//ignorer les commandes ci - dessous, essentiellement pour comprendre le comportement de certaines fonctions\n\nval test = \ngkgDF_selected.select(\"SourceCommonName\",\"DATE\",\"DocumentIdentifier\",\"V2Persons\",\"V2Tone\")\n.withColumn(\"YEAR\", slice($\"DATE\",lit(0),lit(4)))\n.withColumn(\"MONTH\", slice($\"DATE\",lit(4),lit(6)))\n.withColumn(\"DAY\", slice($\"DATE\",lit(6),lit(8)))\n.drop($\"DATE\")\n\ntest.show\n\ntest.select(\"V2Tone\")\n.withColumn(\"V2Tone_split\",split($\"V2Tone\", \",\").getItem(0))\n.withColumn(\"V2Tone_float\",col(\"V2Tone_split\").cast(\"Float\"))\n.filter($\"V2Tone_float\".isNotNull)\n.sort($\"V2Tone_float\".asc).show()","user":"anonymous","dateUpdated":"2020-01-19T14:58:37+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579429349961_439608215","id":"20200119-102229_734888534","dateCreated":"2020-01-19T10:22:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5359","dateFinished":"2020-01-19T12:56:52+0000","dateStarted":"2020-01-19T12:56:52+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------+--------------------+--------------------+----+-----+---+\n|    SourceCommonName|  DocumentIdentifier|           V2Persons|              V2Tone|YEAR|MONTH|DAY|\n+--------------------+--------------------+--------------------+--------------------+----+-----+---+\n|           nbc29.com|http://www.nbc29....|                    |-3.125,1.04166666...|2018|   12| 01|\n|       theusnews.com|https://www.theus...|Akiem Hicks,1174;...|-1.81818181818182...|2018|   12| 01|\n|            wsar.com|http://wsar.com/n...|Las Vega Mccarran...|-1.16618075801749...|2018|   12| 01|\n|     wickedlocal.com|http://marion.wic...|                    |5.83333333333333,...|2018|   12| 01|\n|    newwestrecord.ca|https://www.newwe...|Melissa Burke,115...|-2.91666666666667...|2018|   12| 01|\n|            wrex.com|https://wrex.com/...|David Osborne,698...|-6.76691729323308...|2018|   12| 01|\n|      maravipost.com|http://www.maravi...|Shanetta Yvette W...|-8.90688259109312...|2018|   12| 01|\n|     wickedlocal.com|http://middleboro...|                    |5.83333333333333,...|2018|   12| 01|\n|therolladailynews...|https://www.thero...|Theresa May,5910;...|-2.33863423760524...|2018|   12| 01|\n|     airdrieecho.com|https://www.airdr...|Blaine Higgs,3103...|-5.61708860759494...|2018|   12| 01|\n|   actionnewsjax.com|https://www.actio...|                    |1.8348623853211,2...|2018|   12| 01|\n|      prnewswire.com|https://www.prnew...|   Jason Haynes,1551|0.766283524904215...|2018|   12| 01|\n| businessinsider.com|https://www.busin...|Felix Sater,12;Ro...|-1.96078431372549...|2018|   12| 01|\n| businessinsider.com|https://www.busin...|Donna Wieting,161...|-4.49172576832151...|2018|   12| 01|\n|geelongadvertiser...|https://www.geelo...|Doris Roberts,156...|3.00429184549356,...|2018|   12| 01|\n|    theparisnews.com|http://theparisne...|   Quincy Blount,190|0,3.1746031746031...|2018|   12| 01|\n|    timminstimes.com|https://www.timmi...|Blaine Higgs,3103...|-5.61708860759494...|2018|   12| 01|\n|          wsoctv.com|https://www.wsoct...|                    |1.8348623853211,2...|2018|   12| 01|\n|           radio.com|https://971thetic...|Reggie Bush,2371;...|-0.49115913555992...|2018|   12| 01|\n|          whas11.com|https://www.whas1...|Jerome Powell,236...|-2.59842519685039...|2018|   12| 01|\n+--------------------+--------------------+--------------------+--------------------+----+-----+---+\nonly showing top 20 rows\n\nslice: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function3>,StringType,Some(List(StringType, IntegerType, IntegerType)))\ntest: org.apache.spark.sql.DataFrame = [SourceCommonName: string, DocumentIdentifier: string ... 5 more fields]\n"}]}},{"text":"//TABLE V2PERSONS\n\nval question3Df_person= gkgDF_selected.select(\"SourceCommonName\",\"DATE\",\"DocumentIdentifier\",\"V2Persons\",\"V2Tone\")\n.filter($\"V2Persons\" !== \"\")\n.withColumn(\"V2Tone_split\",split($\"V2Tone\", \",\").getItem(0))\n.withColumn(\"V2Tone_float\",col(\"V2Tone_split\").cast(\"Float\"))\n.filter($\"V2Tone_float\".isNotNull)\n.withColumn(\"Persons_split\", split($\"V2Persons\", \";\"))\n.withColumn(\"Persons_unique\",explode($\"Persons_split\"))\n.withColumn(\"Persons\", split($\"Persons_unique\", \",\").getItem(0))\n.withColumn(\"YEAR\", slice($\"DATE\",lit(0),lit(4)))\n.withColumn(\"MONTH\", slice($\"DATE\",lit(4),lit(6)))\n.withColumn(\"DAY\", slice($\"DATE\",lit(6),lit(8)))\n.drop($\"DATE\")\n.drop($\"Persons_split\")\n.drop($\"Persons_unique\")\n.drop($\"V2Persons\")\n.cache()\n","user":"anonymous","dateUpdated":"2020-01-19T14:58:56+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":117.798,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nquestion3Df_person: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, DocumentIdentifier: string ... 7 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579420156756_2024432214","id":"20200118-181236_1630432387","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T13:04:32+0000","dateFinished":"2020-01-19T13:04:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5361"},{"text":"//TABLE V2THEMES\n\nval question3Df_themes = gkgDF_selected.select(\"SourceCommonName\",\"DATE\",\"DocumentIdentifier\",\"V2Themes\",\"V2Tone\")\n.filter($\"V2Themes\" !== \"\")\n.withColumn(\"V2Tone_split\",split($\"V2Tone\", \",\").getItem(0))\n.withColumn(\"V2Tone_float\",col(\"V2Tone_split\").cast(\"Float\"))\n.filter($\"V2Tone_float\".isNotNull)\n.withColumn(\"Themes_split\", split($\"V2Themes\", \";\"))\n.withColumn(\"Themes_unique\",explode($\"Themes_split\"))\n.withColumn(\"Themes\", split($\"Themes_unique\", \",\").getItem(0))\n.withColumn(\"YEAR\", slice($\"DATE\",lit(0),lit(4)))\n.withColumn(\"MONTH\", slice($\"DATE\",lit(4),lit(6)))\n.withColumn(\"DAY\", slice($\"DATE\",lit(6),lit(8)))\n.drop($\"DATE\")\n.drop($\"Themes_split\")\n.drop($\"Themes_unique\")\n.drop($\"V2Themes\")\n.cache()\n","user":"anonymous","dateUpdated":"2020-01-19T13:05:00+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nquestion3Df_themes: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, DocumentIdentifier: string ... 7 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579420156756_-1250763321","id":"20200118-171547_2104727007","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T13:05:00+0000","dateFinished":"2020-01-19T13:05:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5363"},{"text":"//TABLE V2LOCATION\n\nval question3Df_locations = gkgDF_selected.select(\"SourceCommonName\",\"DATE\",\"DocumentIdentifier\",\"V2Locations\",\"V2Tone\")\n.filter($\"V2Locations\" !== \"\")\n.withColumn(\"V2Tone_split\",split($\"V2Tone\", \",\").getItem(0))\n.withColumn(\"V2Tone_float\",col(\"V2Tone_split\").cast(\"Float\"))\n.filter($\"V2Tone_float\".isNotNull)\n.withColumn(\"Locations_split\", split($\"V2Locations\", \";\"))\n.withColumn(\"locations_unique\",explode($\"Locations_split\"))\n.withColumn(\"Locations_full\", split($\"locations_unique\", \"#\").getItem(1))\n.withColumn(\"Locations\", split($\"Locations_full\", \",\").getItem(0))\n.withColumn(\"YEAR\", slice($\"DATE\",lit(0),lit(4)))\n.withColumn(\"MONTH\", slice($\"DATE\",lit(4),lit(6)))\n.withColumn(\"DAY\", slice($\"DATE\",lit(6),lit(8)))\n.drop($\"DATE\")\n.drop($\"V2Locations\")\n.drop($\"Locations_split\")\n.drop($\"locations_unique\")\n.drop($\"Locations_full\")\n.cache()\n","user":"anonymous","dateUpdated":"2020-01-19T13:05:02+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nquestion3Df_locations: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, DocumentIdentifier: string ... 7 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579420156756_-1571333771","id":"20200118-171547_1053567888","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T13:05:02+0000","dateFinished":"2020-01-19T13:05:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5365"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579436230691_-2067666221","id":"20200119-121710_1364750513","dateCreated":"2020-01-19T12:17:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8981","text":"//affiches les personnes, themes, lieux dont les articles de cette source parlent \n\n//1 - AFFICHER Les personnes dont les articles de cette source parle       //si besoin , supprimer ,\"DocumentIdentifier\"\n\nval question3Df_person_collection= question3Df_person\n.filter($\"Persons\" !== \"\")\n.groupBy(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"DocumentIdentifier\")\n.agg(collect_set(\"Persons\") as \"Persons_collection\")\n.withColumn(\"no_of_Persons\", size($\"Persons_collection\"))\n.sort($\"SourceCommonName\".desc).cache()\n\n\n\n//2 - AFFICHER Les themes dont les articles de cette source parle\n\nval question3Df_themes_collection = question3Df_themes\n.filter($\"Themes\" !== \"\")\n.groupBy(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"DocumentIdentifier\")\n.agg(collect_set(\"Themes\") as \"Themes_collection\")\n.withColumn(\"no_of_themes\", size($\"Themes_collection\"))\n.sort($\"SourceCommonName\".desc).cache()\n\n\n\n//3 - AFFICHER Les lieux dont les articles de cette source parle\n\nval question3Df_locations_collection = question3Df_locations\n.filter($\"Locations\" !== \"\")\n.groupBy(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"DocumentIdentifier\")\n.agg(collect_set(\"Locations\") as \"Locations_collection\")\n.withColumn(\"no_of_locations\", size($\"Locations_collection\"))\n.sort($\"SourceCommonName\".desc).cache()\n\n\n//UNION DES TABLES CI-DESSUS                                                                             //Si besoin, supprimer les colonnes collections\n\nval question3Df_person_themes_locations= question3Df_person_collection\n.join(question3Df_themes_collection, Seq(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"DocumentIdentifier\"))\n.join(question3Df_locations_collection, Seq(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"DocumentIdentifier\"))\n.show()","dateUpdated":"2020-01-19T13:05:10+0000","dateFinished":"2020-01-19T13:06:27+0000","dateStarted":"2020-01-19T13:05:10+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there were three deprecation warnings; re-run with -deprecation for details\n+-------------------+---+-----+----+--------------------+--------------------+-------------+--------------------+------------+--------------------+---------------+\n|   SourceCommonName|Day|Month|Year|  DocumentIdentifier|  Persons_collection|no_of_Persons|   Themes_collection|no_of_themes|Locations_collection|no_of_locations|\n+-------------------+---+-----+----+--------------------+--------------------+-------------+--------------------+------------+--------------------+---------------+\n|       1057thex.com| 01|   12|2018|http://www.1057th...|[Priyanka Chopra,...|            4|[WB_696_PUBLIC_SE...|          14|[India, New York,...|              3|\n|       1090kaay.com| 01|   12|2018|http://www.1090ka...|[Steven Stafford,...|            4|[WB_696_PUBLIC_SE...|          44|[American, Califo...|              2|\n|       1280wnam.com| 01|   12|2018|http://www.1280wn...|[Priyanka Chopra,...|            4|[WB_696_PUBLIC_SE...|          14|[India, New York,...|              3|\n|        1688.com.au| 01|   12|2018|https://www.1688....|        [I Huang Yi]|            1|[USPEC_POLITICS_G...|          18|         [Australia]|              1|\n| 2016carsreview.net| 01|   12|2018|http://2016carsre...|[Angela Merkel, P...|            4|[WB_507_ENERGY_AN...|          76|[South Korea, Uga...|              8|\n|            24tv.ua| 01|   12|2018|https://24tv.ua/r...|[Smartphone Xiaom...|            2|[WB_694_BROADCAST...|         115|[Chinese, Belgian...|             12|\n|        570news.com| 01|   12|2018|https://www.570ne...|[Andrei Demchenko...|            2|[USPEC_POLITICS_G...|          20|[Ukraine, Russia,...|              4|\n|    660citynews.com| 01|   12|2018|https://www.660ci...|     [Frank Jordans]|            1|[WB_346_COMPETITI...|          20|[Poland, Paris, F...|              4|\n|        680news.com| 01|   12|2018|https://www.680ne...| [Lina Reyes-Geddes]|            1|[WB_696_PUBLIC_SE...|          21|[Mexico, Deseret,...|              5|\n|        680news.com| 01|   12|2018|https://www.680ne...|[Detrick Mostella...|            6|[TAX_WORLDLANGUAG...|           3|           [Alabama]|              1|\n|945thehawkradio.com| 01|   12|2018|http://www.945the...|[Priyanka Chopra,...|            4|[WB_696_PUBLIC_SE...|          14|[India, New York,...|              3|\n|             9am.ro| 01|   12|2018|https://www.9am.r...|[Serban Nicholas,...|            2|[USPEC_POLITICS_G...|          30|       [Cluj, Sibiu]|              2|\n|     9and10news.com| 01|   12|2018|https://www.9and1...|   [Elizabeth James]|            1|[CRISISLEX_CRISIS...|           7|[Uganda, Kenya, T...|              4|\n|          abc11.com| 01|   12|2018|https://abc11.com...|[Charles Hellwig,...|            3|[USPEC_POLITICS_G...|          15|[North Carolina, ...|              3|\n|          abc12.com| 01|   12|2018|https://www.abc12...|[John Quincy Adam...|           21|[WB_470_EDUCATION...|         161|[Kennebunkport, G...|             30|\n|           abc7.com| 01|   12|2018|https://abc7.com/...|[Ronald Reagan, R...|           11|[SOC_POINTSOFINTE...|          60|[Maine, Kennebunk...|             12|\n|     accesswdun.com| 01|   12|2018|http://accesswdun...|[Dan Joling, Etha...|           15|[WB_507_ENERGY_AN...|          67|[Anchorage, Unite...|             10|\n|      acento.com.do| 01|   12|2018|https://acento.co...|[Rachel Josephine...|            4|[USPEC_POLITICS_G...|          14|[Mexico, United K...|              4|\n|       acritica.net| 01|   12|2018|http://www.acriti...|        [Dalai Lama]|            1|[USPEC_POLITICS_G...|          42|[France, Kuwait, ...|              9|\n|            actu.fr| 01|   12|2018|https://actu.fr/h...|  [Christmas Square]|            1|[WB_696_PUBLIC_SE...|          15|            [French]|              1|\n+-------------------+---+-----+----+--------------------+--------------------+-------------+--------------------+------------+--------------------+---------------+\nonly showing top 20 rows\n\nquestion3Df_person_collection: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 5 more fields]\nquestion3Df_themes_collection: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 5 more fields]\nquestion3Df_locations_collection: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 5 more fields]\nquestion3Df_person_themes_locations: Unit = ()\n"}]}},{"text":"//afficher le nombre d'article par personne et le ton moyen des article\n\nval question3Df_persons_collection_bis= question3Df_person\n.filter($\"Persons\" !== \"\")\n.groupBy(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"Persons\")\n.agg(collect_set(\"DocumentIdentifier\") as \"Articles_collection\", mean(\"V2Tone_float\").as(\"Tone_mean\"))\n.withColumn(\"no_of_Article_person\", size($\"Articles_collection\"))\n.drop($\"Article_collection\")\n.sort($\"no_of_Article_person\".desc)\n\nquestion3Df_persons_collection_bis.show()\n\n//afficher le nombre d'article par themes et le ton moyen des article\n\nval question3Df_themes_collection_bis= question3Df_themes\n.filter($\"Themes\" !== \"\")\n.groupBy(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"Themes\")\n.agg(collect_set(\"DocumentIdentifier\") as \"Articles_collection\", mean(\"V2Tone_float\").as(\"Tone_mean\"))\n.withColumn(\"no_of_Article_theme\", size($\"Articles_collection\"))\n.drop($\"Article_collection\")\n.sort($\"no_of_Article_theme\".desc)\n\nquestion3Df_themes_collection_bis.show()\n\n//afficher le nombre d'article par lieu et le ton moyen des article\n\nval question3Df_locations_collection_bis= question3Df_locations\n.filter($\"Locations\" !== \"\")\n.groupBy(\"SourceCommonName\",\"Day\",\"Month\",\"Year\",\"Locations\")\n.agg(collect_set(\"DocumentIdentifier\") as \"Articles_collection\", mean(\"V2Tone_float\").as(\"Tone_mean\"))\n.withColumn(\"no_of_Article_location\", size($\"Articles_collection\"))\n.drop($\"Article_collection\")\n.sort($\"no_of_Article_location\".desc)\n\nquestion3Df_locations_collection_bis.show()","user":"anonymous","dateUpdated":"2020-01-19T13:05:14+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there were three deprecation warnings; re-run with -deprecation for details\n+----------------+---+-----+----+--------------------+--------------------+-------------------+--------------------+\n|SourceCommonName|Day|Month|Year|             Persons| Articles_collection|          Tone_mean|no_of_Article_person|\n+----------------+---+-----+----+--------------------+--------------------+-------------------+--------------------+\n|         wafa.ps| 01|   12|2018|           Ram Allah|[http://www.wafa....|-1.8672030269078512|                1657|\n|         wafa.ps| 01|   12|2018|       Mahmoud Abbas|[http://www.wafa....|   4.33578599114363|                1015|\n|      iheart.com| 01|   12|2018|George Herbert Wa...|[https://800wvhu....|-0.9345514224842191|                 531|\n|      iheart.com| 01|   12|2018|            Jeb Bush|[https://800wvhu....|-0.9288955082402112|                 528|\n|      iheart.com| 01|   12|2018|          John Adams|[https://800wvhu....|-0.9347852557275508|                 527|\n|      iheart.com| 01|   12|2018|   John Quincy Adams|[https://800wvhu....|-0.9349781301424984|                 526|\n|      iheart.com| 01|   12|2018|Pauline Robinson ...|[https://800wvhu....|-0.9373656529471988|                 525|\n|      iheart.com| 01|   12|2018|          Bucky Bush|[https://800wvhu....|-0.9373656529471988|                 525|\n|      iheart.com| 01|   12|2018|       Saoirse Ronan|[https://miss103....|                0.0|                 442|\n|      iheart.com| 01|   12|2018|         Mary Stuart|[https://miss103....|                0.0|                 442|\n|      iheart.com| 01|   12|2018|     Queen Elizabeth|[https://miss103....|                0.0|                 442|\n|      iheart.com| 01|   12|2018|       Margot Robbie|[https://miss103....|                0.0|                 442|\n|      iheart.com| 01|   12|2018|Natalie Portmantries|[https://miss103....|                0.0|                 442|\n|      iheart.com| 01|   12|2018|          Mary Queen|[https://miss103....|                0.0|                 442|\n|      iheart.com| 01|   12|2018|    Nightflyers Syfy|[https://sunny947...| 1.4251781702041626|                 311|\n|       ehfcl.com| 01|   12|2018|        Tomas Cuncik|[http://www.ehfcl...|  2.383662709972369|                 307|\n|         wafa.ps| 01|   12|2018|Wizarat Al Kharij...|[http://www.wafa....|  4.513207146877884|                 304|\n|         wafa.ps| 01|   12|2018|       Yasser Arafat|[http://www.wafa....|  3.009044146458042|                 299|\n|  fasopresse.net| 01|   12|2018| Mark Roch Christian|[http://www.fasop...| 0.4826629360386838|                 287|\n|      iheart.com| 01|   12|2018|         Los Angeles|[https://z104fm.i...|  1.154445427404323|                 271|\n+----------------+---+-----+----+--------------------+--------------------+-------------------+--------------------+\nonly showing top 20 rows\n\n+----------------+---+-----+----+--------------------+--------------------+-------------------+-------------------+\n|SourceCommonName|Day|Month|Year|              Themes| Articles_collection|          Tone_mean|no_of_Article_theme|\n+----------------+---+-----+----+--------------------+--------------------+-------------------+-------------------+\n|       bjhmoh.cn| 01|   12|2018|             MEDICAL|[http://bjhmoh.cn...|-0.2432662339405712|               3289|\n|       bjhmoh.cn| 01|   12|2018|CRISISLEX_C03_WEL...|[http://bjhmoh.cn...|-0.2432662339405712|               3289|\n|       bjhmoh.cn| 01|   12|2018|      GENERAL_HEALTH|[http://bjhmoh.cn...|-0.2432662339405712|               3289|\n|       bjhmoh.cn| 01|   12|2018|SOC_POINTSOFINTER...|[http://bjhmoh.cn...|-0.2432662339405712|               3289|\n|       bjhmoh.cn| 01|   12|2018|WB_621_HEALTH_NUT...|[http://bjhmoh.cn...| -1.930510466192368|               3061|\n|         wafa.ps| 01|   12|2018|TAX_ETHNICITY_PAL...|[http://www.wafa....| 1.9226987846331645|               2785|\n|         wafa.ps| 01|   12|2018|USPEC_POLITICS_GE...|[http://www.wafa....| 2.4753912401863234|               2627|\n|       bjhmoh.cn| 01|   12|2018|           EDUCATION|[http://bjhmoh.cn...|-1.0847721413782105|               2455|\n|       joker.com| 01|   12|2018|EPU_ECONOMY_HISTORIC|[https://joker.co...| 10.292221781823963|               2412|\n|       joker.com| 01|   12|2018|TAX_FNCACT_REGISTRAR|[https://joker.co...| 10.416666984558105|               2372|\n|       joker.com| 01|   12|2018|  TAX_FNCACT_PIONEER|[https://joker.co...| 10.416666984558105|               2372|\n|       bjhmoh.cn| 01|   12|2018|WB_1331_HEALTH_TE...|[http://bjhmoh.cn...|-2.3552386492172026|               2273|\n|       bjhmoh.cn| 01|   12|2018|    WB_1406_DISEASES|[http://bjhmoh.cn...| -3.679278315533436|               2271|\n|       bjhmoh.cn| 01|   12|2018|WB_1350_PHARMACEU...|[http://bjhmoh.cn...|-2.2474031121787115|               2178|\n|         wafa.ps| 01|   12|2018|              LEADER|[http://www.wafa....|  3.145593114230995|               2010|\n|       bjhmoh.cn| 01|   12|2018| TAX_FNCACT_DIRECTOR|[http://bjhmoh.cn...|-0.7539822272577725|               1997|\n|       bjhmoh.cn| 01|   12|2018|USPEC_POLITICS_GE...|[http://bjhmoh.cn...|0.38898638642156097|               1939|\n|         wafa.ps| 01|   12|2018|TAX_FNCACT_PRESIDENT|[http://www.wafa....|  3.197520568902332|               1897|\n|       bjhmoh.cn| 01|   12|2018|WB_697_SOCIAL_PRO...|[http://bjhmoh.cn...| -3.177506136378609|               1896|\n|       bjhmoh.cn| 01|   12|2018|     UNGP_HEALTHCARE|[http://bjhmoh.cn...|-3.7334955820217477|               1893|\n+----------------+---+-----+----+--------------------+--------------------+-------------------+-------------------+\nonly showing top 20 rows\n\n+----------------+---+-----+----+-------------+--------------------+--------------------+----------------------+\n|SourceCommonName|Day|Month|Year|    Locations| Articles_collection|           Tone_mean|no_of_Article_location|\n+----------------+---+-----+----+-------------+--------------------+--------------------+----------------------+\n|       bjhmoh.cn| 01|   12|2018|      Beijing|[http://bjhmoh.cn...|-0.19324040229624626|                  3241|\n|         wafa.ps| 01|   12|2018|  Palestinian|[http://www.wafa....|  1.8480160811186148|                  2479|\n|         wafa.ps| 01|   12|2018|      Israeli|[http://www.wafa....|  -2.408347326230868|                  2309|\n|         wafa.ps| 01|   12|2018|    Palestine|[http://www.wafa....|    2.11251542817207|                  2290|\n|         wafa.ps| 01|   12|2018|    Jerusalem|[http://www.wafa....| -1.0533141483989508|                  2051|\n|       bjhmoh.cn| 01|   12|2018|        China|[http://bjhmoh.cn...| -0.6506391605679128|                  1950|\n|         wafa.ps| 01|   12|2018|       Israel|[http://www.wafa....|  -1.382567520857751|                  1395|\n|  fasopresse.net| 01|   12|2018|  Ouagadougou|[http://www.fasop...|  1.0545050832014442|                  1243|\n|  fasopresse.net| 01|   12|2018| Burkina Faso|[http://www.fasop...|  0.8390306042863077|                  1058|\n|       bjhmoh.cn| 01|   12|2018|       Peking|[http://bjhmoh.cn...| -0.8896186836577422|                  1015|\n| english.wafa.ps| 01|   12|2018|  Palestinian|[http://english.w...| -3.4893756307033845|                   950|\n|      iheart.com| 01|   12|2018|      America|[https://literock...|  0.5699923803975292|                   912|\n|       zazoom.it| 01|   12|2018|      Italian|[https://www.zazo...| 0.32400539141716594|                   867|\n| english.wafa.ps| 01|   12|2018|       Israel|[http://english.w...| -3.1988000381188315|                   835|\n|    ziarelive.ro| 01|   12|2018|      Romania|[http://www.ziare...|  1.3167986269634393|                   818|\n|     sina.com.tw| 01|   12|2018|        China|[https://news.sin...|  1.1541235289943892|                   751|\n| english.wafa.ps| 01|   12|2018|      Israeli|[http://english.w...| -6.4296902118370545|                   730|\n|      iheart.com| 01|   12|2018|     American|[https://800wvhu....|  0.8747880184895371|                   724|\n|         wafa.ps| 01|   12|2018|United States|[http://www.wafa....| -1.0214702271543308|                   719|\n|         wafa.ps| 01|   12|2018|         Gaza|[http://www.wafa....| -3.3510891845578055|                   698|\n+----------------+---+-----+----+-------------+--------------------+--------------------+----------------------+\nonly showing top 20 rows\n\nquestion3Df_persons_collection_bis: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 6 more fields]\nquestion3Df_themes_collection_bis: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 6 more fields]\nquestion3Df_locations_collection_bis: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 6 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579433893381_-244106807","id":"20200119-113813_1306004844","dateCreated":"2020-01-19T11:38:13+0000","dateStarted":"2020-01-19T13:05:14+0000","dateFinished":"2020-01-19T13:07:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5366"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579438054993_-56723071","id":"20200119-124734_1053381587","dateCreated":"2020-01-19T12:47:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9743","text":"//test\n\nval source_against_china = question3Df_locations_collection_bis.filter($\"Locations\" === \"China\").filter($\"no_of_Article_location\" >= 20).sort($\"Tone_mean\".asc)\nsource_against_china.show\n\nval source_pro_china = question3Df_locations_collection_bis.filter($\"Locations\" === \"China\").filter($\"no_of_Article_location\" >= 20).sort($\"Tone_mean\".desc)\nsource_pro_china.show","dateUpdated":"2020-01-19T13:10:29+0000","dateFinished":"2020-01-19T13:10:39+0000","dateStarted":"2020-01-19T13:10:29+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------+---+-----+----+---------+--------------------+-------------------+----------------------+\n|   SourceCommonName|Day|Month|Year|Locations| Articles_collection|          Tone_mean|no_of_Article_location|\n+-------------------+---+-----+----+---------+--------------------+-------------------+----------------------+\n|            time.mk| 01|   12|2018|    China|[https://time.mk/...| -4.388883832622977|                    23|\n|     focus-news.net| 01|   12|2018|    China|[http://focus-new...| -4.350113540130146|                    35|\n|          ntdtv.com| 01|   12|2018|    China|[http://www.ntdtv...|  -3.43241509707535|                    43|\n|    dailymail.co.uk| 01|   12|2018|    China|[https://www.dail...| -2.939185628836805|                    37|\n|    soundofhope.org| 01|   12|2018|    China|[http://www.sound...| -2.757648286441791|                    38|\n|      newstimes.com| 01|   12|2018|    China|[https://www.news...| -2.631014565866569|                    23|\n| washingtonpost.com| 01|   12|2018|    China|[https://www.wash...| -2.566756632313671|                    32|\n|      seattlepi.com| 01|   12|2018|    China|[https://www.seat...|-2.4956772855626856|                    29|\n|   timesofearth.com| 01|   12|2018|    China|[http://www.times...| -2.484089109344759|                    30|\n|  greenwichtime.com| 01|   12|2018|    China|[https://www.gree...| -2.481859296003235|                    23|\n|     nhregister.com| 01|   12|2018|    China|[https://www.nhre...|  -2.47121673948684|                    26|\n|     nzherald.co.nz| 01|   12|2018|    China|[https://www.nzhe...| -2.468098304986954|                    38|\n|registercitizen.com| 01|   12|2018|    China|[https://www.regi...| -2.440501159111273|                    21|\n|     epochtimes.com| 01|   12|2018|    China|[http://www.epoch...|-2.4387093187716906|                    46|\n|  chinapress.com.my| 01|   12|2018|    China|[http://www.china...|-2.2932352598756554|                    20|\n|          chron.com| 01|   12|2018|    China|[https://www.chro...|-2.2270612016460363|                    69|\n|          regnum.ru| 01|   12|2018|    China|[https://regnum.r...|-2.1775245041879887|                    27|\n|         ctpost.com| 01|   12|2018|    China|[https://www.ctpo...|-2.0775306735038757|                    25|\n|            bbc.com| 01|   12|2018|    China|[https://www.bbc....| -2.072750479825165|                    36|\n|         tucson.com| 01|   12|2018|    China|[https://tucson.c...|-2.0010690267493083|                    35|\n+-------------------+---+-----+----+---------+--------------------+-------------------+----------------------+\nonly showing top 20 rows\n\n+-----------------+---+-----+----+---------+--------------------+------------------+----------------------+\n| SourceCommonName|Day|Month|Year|Locations| Articles_collection|         Tone_mean|no_of_Article_location|\n+-----------------+---+-----+----+---------+--------------------+------------------+----------------------+\n|      prnasia.com| 01|   12|2018|    China|[https://www.prna...|  4.46558659996789|                    68|\n|          wafa.ps| 01|   12|2018|    China|[http://www.wafa....|  4.38334341064651|                   219|\n|        china.com| 01|   12|2018|    China|[https://military...|3.4801855015371186|                    40|\n|       lyd.com.cn| 01|   12|2018|    China|[http://news.lyd....|  3.30717683538558|                    24|\n|        hinews.cn| 01|   12|2018|    China|[http://www.hinew...| 3.304302132898761|                    26|\n|       timedg.com| 01|   12|2018|    China|[http://news.time...|3.2332952758149496|                    21|\n|         ycwb.com| 01|   12|2018|    China|[http://news.ycwb...|  3.19704275598597|                    30|\n|      cnnb.com.cn| 01|   12|2018|    China|[http://news.cnnb...|  2.96001676421973|                    24|\n|        dayoo.com| 01|   12|2018|    China|[http://news.dayo...|2.9578677677563605|                    36|\n|        fjsen.com| 01|   12|2018|    China|[http://fjnews.fj...| 2.932016222679942|                    59|\n|      nxtv.com.cn| 01|   12|2018|    China|[http://news.nxtv...| 2.903304063056776|                    21|\n|  hangzhou.com.cn| 01|   12|2018|    China|[http://news.hang...|2.8986300223068504|                    55|\n|      southcn.com| 01|   12|2018|    China|[http://economy.s...| 2.845159754310075|                    82|\n|chinadaily.com.cn| 01|   12|2018|    China|[http://www.china...| 2.795651387709838|                   174|\n|   nmgnews.com.cn| 01|   12|2018|    China|[http://china.nmg...|2.7528147049644747|                    30|\n|         sify.com| 01|   12|2018|    China|[http://www.sify....| 2.679430061265042|                    21|\n|            81.cn| 01|   12|2018|    China|[http://www.81.cn...| 2.639835907826348|                    54|\n|      dqdaily.com| 01|   12|2018|    China|[http://shishi.dq...|2.5463476708798956|                    20|\n|      zjol.com.cn| 01|   12|2018|    China|[http://china.zjo...|2.5414177174077315|                    67|\n|world.workercn.cn| 01|   12|2018|    China|[http://world.wor...| 2.471917382498019|                    24|\n+-----------------+---+-----+----+---------+--------------------+------------------+----------------------+\nonly showing top 20 rows\n\nsource_against_china: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 6 more fields]\nsource_pro_china: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [SourceCommonName: string, Day: string ... 6 more fields]\n"}]}},{"text":"//Try with all of them  /// DOESN't WORK, TOO LONG\n\nval question3Df = gkgDF_selected.select(\"SourceCommonName\",\"DATE\",\"DocumentIdentifier\",\"V2Persons\",\"V2Themes\",\"V2Locations\",\"V2Tone\")\n.filter($\"V2Persons\" !== \"\")\n.filter($\"V2Themes\" !== \"\")\n\n.withColumn(\"Persons_split\", split($\"V2Persons\", \";\"))\n.withColumn(\"Persons_unique\",explode($\"Persons_split\"))\n.withColumn(\"Persons\", split($\"Persons_unique\", \",\").getItem(0))\n.withColumn(\"Themes_split\", split($\"V2Themes\", \";\"))\n.withColumn(\"Themes_unique\",explode($\"Themes_split\"))\n.withColumn(\"Themes\", split($\"Themes_unique\", \",\").getItem(0))\n.withColumn(\"Locations_split\", split($\"V2Locations\", \";\"))\n.withColumn(\"locations_unique\",explode($\"Locations_split\"))\n.withColumn(\"Locations_full\", split($\"locations_unique\", \"#\").getItem(1))\n.withColumn(\"Locations\", split($\"Locations_full\", \",\").getItem(0))\n.drop($\"Persons_split\")\n.drop($\"Persons_unique\")\n.drop($\"V2Persons\")\n.drop($\"Themes_split\")\n.drop($\"Themes_unique\")\n.drop($\"V2Themes\")\n.drop($\"V2Locations\")\n.drop($\"Locations_split\")\n.drop($\"locations_unique\")\n.drop($\"Locations_full\")\n\nval question3Df_test=question3Df.filter($\"SourceCommonName\" === \"zoomerradio.ca\")\n\n//.agg(collect_set(\"Persons\") as \"Persons_collection\", collect_set(\"Themes\") as \"Themes_collection\", collect_set(\"Locations\") as \"Locations_collection\")\n//.withColumn(\"no_of_Persons\", size($\"Persons_collection\")).sort($\"SourceCommonName\".desc)\n//.withColumn(\"no_of_themes\", size($\"Themes_collection\"))\n//.withColumn(\"no_of_locations\", size($\"Locations_collection\"))\n//.show()","user":"anonymous","dateUpdated":"2020-01-19T11:12:02+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"<console>:60: error: value show is not a member of org.apache.spark.sql.RelationalGroupedDataset\npossible cause: maybe a semicolon is missing before `value show'?\n       .show(false)\n        ^\n"}]},"apps":[],"jobName":"paragraph_1579420156756_1758068618","id":"20200118-171546_1519210875","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T11:11:28+0000","dateFinished":"2020-01-19T11:11:28+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:5371"},{"text":"%md \n### 4) dresser la cartographie des relations entre les pays d’après le ton des articles : pour chaque paire (pays1, pays2), calculer le nombre d’article, le ton moyen (aggrégations sur Année/Mois/Jour, filtrage par pays ou carré de coordonnées)","user":"anonymous","dateUpdated":"2020-01-19T10:31:12+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>4) dresser la cartographie des relations entre les pays d’après le ton des articles : pour chaque paire (pays1, pays2), calculer le nombre d’article, le ton moyen (aggrégations sur Année/Mois/Jour, filtrage par pays ou carré de coordonnées)</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156757_-1403809250","id":"20200118-171733_1899814154","dateCreated":"2020-01-19T07:49:16+0000","dateStarted":"2020-01-19T10:31:12+0000","dateFinished":"2020-01-19T10:31:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5373"},{"text":"//fonction pour couper la date\nval slice = udf((string : String, from : Int, to : Int) => string.slice(from,to))","user":"anonymous","dateUpdated":"2020-01-19T15:00:01+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579420156757_668840378","id":"20200118-171732_844439455","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5374"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579441430587_-327588690","id":"20200119-134350_964253015","dateCreated":"2020-01-19T13:43:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11152","text":"//on ne prend en compte que les articles avec actor1 et actor2\n\nval question4Df = event_mention_DF.select(\"Actor1CountryCode\",\"Actor2CountryCode\",\"GLOBALEVENTID\",\"MentionTimeDate\",\"MentionIdentifier\",\"MentionDocTone\")\n.filter($\"Actor1CountryCode\" !== \"\")\n.filter($\"Actor2CountryCode\" !== \"\")\n.filter($\"Actor1CountryCode\" !== $\"Actor2CountryCode\")       \n.withColumn(\"CountryPair\", array(event_mention_DF(\"Actor1CountryCode\"), event_mention_DF(\"Actor2CountryCode\")))\n.withColumn(\"CountryPair_sorted\", sort_array($\"CountryPair\"))                                                             // to avoid having [USA,FRANCE] different from [FRANCE,USA]\n.withColumn(\"YEAR\", slice($\"MentionTimeDate\",lit(0),lit(4)))\n.withColumn(\"MONTH\", slice($\"MentionTimeDate\",lit(4),lit(6)))\n.withColumn(\"DAY\", slice($\"MentionTimeDate\",lit(6),lit(8)))\n\n\n//jour\nval question4Df_jour = question4Df\n.groupBy(\"CountryPair_sorted\",\"DAY\",\"MONTH\",\"YEAR\")\n.agg(countDistinct($\"MentionIdentifier\") as \"distinct_count\", mean(\"MentionDocTone\").as(\"Tone_mean\"))\n.withColumnRenamed(\"DAY\", \"jour\")\n.withColumnRenamed(\"MONTH\", \"mois\")\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"CountryPair_sorted\", \"pair_pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\nquestion4Df_jour.show()\n\n//mois\nval question4Df_month = question4Df\n.groupBy(\"CountryPair_sorted\",\"MONTH\",\"YEAR\")\n.agg(countDistinct($\"MentionIdentifier\") as \"distinct_count\", mean(\"MentionDocTone\").as(\"Tone_mean\"))\n.withColumnRenamed(\"MONTH\", \"mois\")\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"CountryPair_sorted\", \"pair_pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\nquestion4Df_month.show()\n\n//annee\nval question4Df_year= question4Df\n.groupBy(\"CountryPair_sorted\",\"YEAR\")\n.agg(countDistinct($\"MentionIdentifier\") as \"distinct_count\", mean(\"MentionDocTone\").as(\"Tone_mean\"))\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"CountryPair_sorted\", \"pair_pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\nquestion4Df_year.show()\n\n\n","dateUpdated":"2020-01-19T15:03:23+0000","dateFinished":"2020-01-19T15:03:34+0000","dateStarted":"2020-01-19T15:03:23+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there were three deprecation warnings; re-run with -deprecation for details\n+----------+----+----+-----+--------------+-------------------+\n| pair_pays|jour|mois|annee|nombre_article|          Tone_mean|\n+----------+----+----+-----+--------------+-------------------+\n|[ARG, RUS]|  01|  12| 2018|          1005|-0.7760012067411437|\n|[GBR, USA]|  01|  12| 2018|           480|-0.8875242322010897|\n|[CAN, EUR]|  01|  12| 2018|            13| 1.8873948146954538|\n|[GBR, MDV]|  01|  12| 2018|             6|-3.8180799247045583|\n|[BLR, EUR]|  01|  12| 2018|             8|-1.1779392203577954|\n|[AFR, MOZ]|  01|  12| 2018|             2|   2.83795534887238|\n|[CHN, MNG]|  01|  12| 2018|             1|  -1.09689213893967|\n|[BLR, RUS]|  01|  12| 2018|            13| -1.900381076693693|\n|[BTN, LKA]|  01|  12| 2018|             2| 0.5568505568505534|\n|[JOR, RUS]|  01|  12| 2018|             1|   1.19760479041916|\n|[DEU, PSE]|  01|  12| 2018|             3|-1.4702000987533224|\n|[DEU, MKD]|  01|  12| 2018|             1|  -3.60824742268041|\n|[ECU, SLV]|  01|  12| 2018|             1|   3.30788804071247|\n|[ARE, EGY]|  01|  12| 2018|             1|   3.13075506445672|\n|[EUR, SAU]|  01|  12| 2018|            54| -1.006907176192911|\n|[CAN, LVA]|  01|  12| 2018|             2|-2.2763822236618196|\n|[LBY, SAU]|  01|  12| 2018|             4| 0.6426368842476219|\n|[ITA, UKR]|  01|  12| 2018|             5|-2.0072857581575625|\n|[BEL, UKR]|  01|  12| 2018|             1|-2.4271844660194195|\n|[BLZ, NLD]|  01|  12| 2018|             2|-0.2213937565985325|\n+----------+----+----+-----+--------------+-------------------+\nonly showing top 20 rows\n\n+----------+----+-----+--------------+-------------------+\n| pair_pays|mois|annee|nombre_article|          Tone_mean|\n+----------+----+-----+--------------+-------------------+\n|[DNK, USA]|  12| 2018|            20|-0.7539903489749501|\n|[GBR, YEM]|  12| 2018|             9|  -2.21854506030714|\n|[ASA, ESP]|  12| 2018|             1|  -1.45985401459854|\n|[AUS, IDN]|  12| 2018|             3|-1.2759620670028988|\n|[BRA, EGY]|  12| 2018|             3| -2.964992781255298|\n|[MOZ, ZAF]|  12| 2018|             1|    3.7117903930131|\n|[VEN, VNM]|  12| 2018|             3|-1.8202148728464476|\n|[IDN, VUT]|  12| 2018|             1|                0.0|\n|[NMR, RUS]|  12| 2018|             2|-0.6116366840687699|\n|[DNK, FRA]|  12| 2018|             2|  -5.72783890156086|\n|[BLR, FRA]|  12| 2018|             1|  -5.43565147881694|\n|[RUS, RWA]|  12| 2018|             2| 1.5700671021650372|\n|[AZE, KWT]|  12| 2018|             2| 0.5522676667057301|\n|[HND, SLV]|  12| 2018|             1|  -0.67681895093063|\n|[JOR, RUS]|  12| 2018|             1|   1.19760479041916|\n|[EST, RUS]|  12| 2018|             6| -5.498781611725773|\n|[ARG, DEU]|  12| 2018|           714| -0.768727867390831|\n|[AUT, MEX]|  12| 2018|             2|  -2.99667036625972|\n|[BGD, PAK]|  12| 2018|            11|0.08441355072942718|\n|[NGA, POL]|  12| 2018|            15| 1.1090721177001828|\n+----------+----+-----+--------------+-------------------+\nonly showing top 20 rows\n\n+----------+-----+--------------+-------------------+\n| pair_pays|annee|nombre_article|          Tone_mean|\n+----------+-----+--------------+-------------------+\n|[CAN, USA]| 2018|           381|-0.7339626078555007|\n|[BRA, EUR]| 2018|            11| 0.6794829053830066|\n|[SAU, SEA]| 2018|             1|  -1.87134502923976|\n|[CHN, PHL]| 2018|             5|-0.4515529609597956|\n|[AFR, GRD]| 2018|             1|   2.46913580246914|\n|[BRA, JPN]| 2018|             1|   1.88976377952756|\n|[COG, TZA]| 2018|             1|    -5.175983436853|\n|[BEL, COG]| 2018|             1|  -0.40733197556008|\n|[GBR, PAN]| 2018|             1|  -0.35460992907801|\n|[ARG, PRT]| 2018|             1|   3.10344827586207|\n|[MEX, USA]| 2018|           966| -1.412661278486415|\n|[COL, ECU]| 2018|             5| -6.083681752983184|\n|[JPN, NLD]| 2018|            18|-1.1035554599520818|\n|[ESP, SWE]| 2018|             3| -1.821292229972158|\n|[ARG, SYR]| 2018|             6|-0.9688155806018517|\n|[AUS, CHE]| 2018|             8|-1.6351228772141042|\n|[GBR, IDN]| 2018|             2| 0.9973336068095601|\n|[ESP, GIN]| 2018|             1|  -2.42718446601942|\n|[ARM, DEU]| 2018|             2| -5.103759306024254|\n|[GBR, RUS]| 2018|           111| -2.173505954914494|\n+----------+-----+--------------+-------------------+\nonly showing top 20 rows\n\nquestion4Df: org.apache.spark.sql.DataFrame = [Actor1CountryCode: string, Actor2CountryCode: string ... 9 more fields]\nquestion4Df_jour: org.apache.spark.sql.DataFrame = [pair_pays: array<string>, jour: string ... 4 more fields]\nquestion4Df_month: org.apache.spark.sql.DataFrame = [pair_pays: array<string>, mois: string ... 3 more fields]\nquestion4Df_year: org.apache.spark.sql.DataFrame = [pair_pays: array<string>, annee: string ... 2 more fields]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579443076486_1917204620","id":"20200119-141116_1091176903","dateCreated":"2020-01-19T14:11:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11653","text":"//justification entre utilisation de COUNT VS COUNTDISTINCT   et CountryPair VS CountryPair_sorted\n\n//EN UTILISANT COUNT (nombre de mentions),  avec [USA,FRANCE] different de [FRANCE,USA]\n\nval question4Df_year_unsorted= question4Df\n.groupBy(\"CountryPair\",\"YEAR\")\n.agg(count($\"MentionIdentifier\") as \"distinct_count\", mean(\"MentionDocTone\").as(\"Tone_mean\"))\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"CountryPair\", \"pair_pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\nquestion4Df_year_unsorted.where(array_contains($\"pair_pays\", \"CAN\")).where(array_contains($\"pair_pays\", \"USA\"))show()\n\n\n//EN UTILISANT COUNT(nombre de mentions) ,  avec [USA,FRANCE] = [FRANCE,USA] \nval question4Df_year_sorted= question4Df\n.groupBy(\"CountryPair_sorted\",\"YEAR\")\n.agg(count($\"MentionIdentifier\") as \"distinct_count\", mean(\"MentionDocTone\").as(\"Tone_mean\"))\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"CountryPair_sorted\", \"pair_pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\nquestion4Df_year_sorted.where(array_contains($\"pair_pays\", \"CAN\")).where(array_contains($\"pair_pays\", \"USA\"))show()\n\n//EN UTILISANT COUNTDISTINCT (nombre d'articles), avec [USA,FRANCE] different de [FRANCE,USA]\n\nval question4Df_year_unsorted_distinct = question4Df\n.groupBy(\"CountryPair\",\"YEAR\")\n.agg(countDistinct($\"MentionIdentifier\") as \"distinct_count\", mean(\"MentionDocTone\").as(\"Tone_mean\"))\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"CountryPair\", \"pair_pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\nquestion4Df_year_unsorted_distinct.where(array_contains($\"pair_pays\", \"CAN\")).where(array_contains($\"pair_pays\", \"USA\"))show()\n\n\n//EN UTILISANT COUNTDISTINCT (nombre d'articles), avec [USA,FRANCE] == [FRANCE,USA]                                                                                                                            //CELUI QU'ON DEVRAIT UTILISER\nval question4Df_year_sorted_distinct= question4Df\n.groupBy(\"CountryPair_sorted\",\"YEAR\")\n.agg(countDistinct($\"MentionIdentifier\") as \"distinct_count\", mean(\"MentionDocTone\").as(\"Tone_mean\"))\n.withColumnRenamed(\"YEAR\", \"annee\")\n.withColumnRenamed(\"CountryPair_sorted\", \"pair_pays\")                                                                             //FIPS10-4 Country code dictionnary\n.withColumnRenamed(\"GLOBALEVENTID\", \"evenement\")\n.withColumnRenamed(\"distinct_count\", \"nombre_article\")\n\nquestion4Df_year_sorted_distinct.where(array_contains($\"pair_pays\", \"CAN\")).where(array_contains($\"pair_pays\", \"USA\"))show()","dateUpdated":"2020-01-19T15:02:41+0000","dateFinished":"2020-01-19T14:49:57+0000","dateStarted":"2020-01-19T14:49:52+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----+--------------+-------------------+\n| pair_pays|annee|nombre_article|          Tone_mean|\n+----------+-----+--------------+-------------------+\n|[CAN, USA]| 2018|           837|-0.8449978254760903|\n|[USA, CAN]| 2018|           769|-0.6131089314596184|\n+----------+-----+--------------+-------------------+\n\n+----------+-----+--------------+-------------------+\n| pair_pays|annee|nombre_article|          Tone_mean|\n+----------+-----+--------------+-------------------+\n|[CAN, USA]| 2018|          1606|-0.7339626078555008|\n+----------+-----+--------------+-------------------+\n\n+----------+-----+--------------+-------------------+\n| pair_pays|annee|nombre_article|          Tone_mean|\n+----------+-----+--------------+-------------------+\n|[CAN, USA]| 2018|           327|-0.8449978254760905|\n|[USA, CAN]| 2018|           236| -0.613108931459619|\n+----------+-----+--------------+-------------------+\n\n+----------+-----+--------------+-------------------+\n| pair_pays|annee|nombre_article|          Tone_mean|\n+----------+-----+--------------+-------------------+\n|[CAN, USA]| 2018|           381|-0.7339626078555014|\n+----------+-----+--------------+-------------------+\n\nquestion4Df_year_unsorted: org.apache.spark.sql.DataFrame = [pair_pays: array<string>, annee: string ... 2 more fields]\nquestion4Df_year_sorted: org.apache.spark.sql.DataFrame = [pair_pays: array<string>, annee: string ... 2 more fields]\nquestion4Df_year_unsorted_distinct: org.apache.spark.sql.DataFrame = [pair_pays: array<string>, annee: string ... 2 more fields]\nquestion4Df_year_sorted_distinct: org.apache.spark.sql.DataFrame = [pair_pays: array<string>, annee: string ... 2 more fields]\n"}]}},{"text":"%md A vous de jouer ! Utilisez la documentation GDELT(https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/) et commencez a explorer les donnees via les API Spark.","user":"anonymous","dateUpdated":"2020-01-19T07:49:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>A vous de jouer ! Utilisez la documentation GDELT(<a href=\"https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/\">https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/</a>) et commencez a explorer les donnees via les API Spark.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579420156757_1061891767","id":"20171218-084519_765381887","dateCreated":"2020-01-19T07:49:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5376"}],"name":"gdeltExploration (S3 + 1 mois)","id":"2EYAUPGW7","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}