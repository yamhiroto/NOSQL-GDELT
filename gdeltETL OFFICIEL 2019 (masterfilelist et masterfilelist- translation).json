{"paragraphs":[{"text":"%md\n## Jeu de donnees\nThe Global Database of Events, Language, and Tone (*GDELT*), est une initiative pour construire un catalogue de comportements et de croyances sociales à travers le monde, reliant chaque personne, organisation, lieu, dénombrement, thème, source d'information, et événement à travers la planète en un seul réseau massif qui capture ce qui se passe dans le monde, le contexte, les implications ainsi que la perception des gens sur chaque jour.\n\n\nCette base de données a eu beaucoup d'utilisations, par exemple pour mieux comprendre l'évolution et l'impact de la crise financière du 2008 (https://arxiv.org/pdf/1403.2272v1.pdf[Bayesian dynamic financial networks with time-varying predictors]) ou analyser l'évolution des relations entre des pays impliquées dans des conflits (http://www.gao.ece.ufl.edu/GXU/fun_reading/sbp_hurst.pdf[Massive Media Event Data Analysis to Assess World-Wide Political Conflict and Instability] ).\n\nGDELT est compose par trois jeux de fichiers CSV, avec un fichier compressé par tranche de 15 minutes:\n\n* les events (https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.events?tab=schema[schema], http://data.gdeltproject.org/documentation/CAMEO.Manual.1.1b3.pdf[CAMEO Ontology], http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation])\n* les mentions (https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.eventmentions[schema], http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation])\n* le graph des relations => GKG, Global Knowledge Graph (https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.gkg[schema], http://data.gdeltproject.org/documentation/GDELT-Global_Knowledge_Graph_Codebook-V2.1.pdf[documentation])\n\nL'ensemble des donnees _GDELT_ sont disponibles via HTTP. Un fichier CSV _masterfilelist.txt_\n(http://data.gdeltproject.org/gdeltv2/masterfilelist.txt[Master CSV data file list]) nous permmet d'avoir la liste de tous les fichiers du jeu de donnees GDELT ainsi que l'URL pour telecharger chaque fichier.\n\n\nPour plus d'infos sur le format des fichiers vous pouvez consulter la documentation GDELT: https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/\n","user":"anonymous","dateUpdated":"2020-01-21T08:09:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579594127987_-543159571","id":"20181212-100610_115068599","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T08:09:19+0000","dateFinished":"2020-01-21T08:09:21+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6181"},{"text":"%md\nDans ce notebook nous allons telecharger les fichiers GDELT pour la journee de 1er decembre 2018.\nOn commence par definir une function *fileDownloder* qui telecharge un fichier a partir d'un URL.","user":"anonymous","dateUpdated":"2020-01-21T08:08:47+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579594127992_-257547310","id":"20181212-100702_1116690996","dateCreated":"2020-01-21T08:08:47+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6182"},{"text":"import sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection \nimport org.apache.spark.sql.functions._\n\n\ndef fileDownloader(urlOfFileToDownload: String, fileName: String) = {\n    val url = new URL(urlOfFileToDownload)\n    val connection = url.openConnection().asInstanceOf[HttpURLConnection]\n    connection.setConnectTimeout(5000)\n    connection.setReadTimeout(5000)\n    connection.connect()\n\n    if (connection.getResponseCode >= 400)\n        println(\"error\")\n    else\n        url #> new File(fileName) !!\n}","user":"anonymous","dateUpdated":"2020-01-21T09:39:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one feature warning; re-run with -feature for details\nimport sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection\nimport org.apache.spark.sql.functions._\nfileDownloader: (urlOfFileToDownload: String, fileName: String)Any\n"}]},"apps":[],"jobName":"paragraph_1579594127993_1237574147","id":"20181209-161931_737140067","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T09:39:59+0000","dateFinished":"2020-01-21T09:39:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6183"},{"text":"%md\nOn peut tester cette function pour telecharger en local le *masterfilelist* GDELT. Sur quelle machine ce fichier sera stocque ? ","user":"anonymous","dateUpdated":"2020-01-21T08:08:47+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579594127993_635651631","id":"20181212-101024_1671681559","dateCreated":"2020-01-21T08:08:47+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6184"},{"text":"fileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist.txt\", \"/mnt/tmp/masterfilelist.txt\") // save the list file to the Spark Master\nfileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist-translation.txt\", \"/mnt/tmp/masterfilelist-translation.txt\") ","user":"anonymous","dateUpdated":"2020-01-21T09:40:07+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res24: Any = \"\"\n"}]},"apps":[],"jobName":"paragraph_1579594127993_1930695266","id":"20181209-162121_1695304399","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T09:40:07+0000","dateFinished":"2020-01-21T09:40:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6185"},{"text":"%md\nOn peut vérifier que les fichiers ont bien été téléchargés","user":"anonymous","dateUpdated":"2020-01-21T08:08:47+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579594127994_2116234740","id":"20181212-101108_352331024","dateCreated":"2020-01-21T08:08:47+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6186"},{"text":"%sh\nls -lrth /mnt/tmp |grep masterfilelist","user":"anonymous","dateUpdated":"2020-01-21T08:21:49+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"-rw-r--r--  1 zeppelin zeppelin  53M Jan 21 08:21 masterfilelist.txt\n-rw-r--r--  1 zeppelin zeppelin  57M Jan 21 08:21 masterfilelist-translation.txt\n"}]},"apps":[],"jobName":"paragraph_1579594127994_1206326642","id":"20181210-111357_801203770","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T08:21:49+0000","dateFinished":"2020-01-21T08:21:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6187"},{"text":"\nimport com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\n\nval AWS_ID =\"###\"\nval AWS_KEY=\"###\"\n// la classe AmazonS3Client n'est pas serializable\n// on rajoute l'annotation @transient pour dire a Spark de ne pas essayer de serialiser cette classe et l'envoyer aux executeurs\n@transient val awsClient = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\n\nawsClient.putObject(\"hiroto-yamakawa-telecom-gdelt2019\", \"masterfilelist.txt\", new File( \"/mnt/tmp/masterfilelist.txt\") )\nawsClient.putObject(\"hiroto-yamakawa-telecom-gdelt2019\", \"masterfilelist-translation.txt\", new File( \"/mnt/tmp/masterfilelist-translation.txt\") )","user":"anonymous","dateUpdated":"2020-01-21T09:40:11+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nimport com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\nAWS_ID: String = AKIAXHHHYZU35B42OVBA\nAWS_KEY: String = sFZBr4q1VKlRAQ3Ud8SAG8BsI+kKHKuom9JR7byb\nawsClient: com.amazonaws.services.s3.AmazonS3Client = com.amazonaws.services.s3.AmazonS3Client@683a1072\nres25: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@4911b6fa\n"}]},"apps":[],"jobName":"paragraph_1579594798361_161524658","id":"20200121-081958_1657872054","dateCreated":"2020-01-21T08:19:58+0000","dateStarted":"2020-01-21T09:40:11+0000","dateFinished":"2020-01-21T09:40:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6188"},{"text":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\n//import com.amazonaws.auth.BasicSessionCredentials               //Lorqu'on utilise AWS normal, utilisez BasicAWSCredentials(AWS_ID,AWS_KEY)     \n\n//val PROVIDER = \"org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider\"\nval AWS_ID =\"AKIAXHHHYZU35B42OVBA\"\nval AWS_KEY =\"sFZBr4q1VKlRAQ3Ud8SAG8BsI+kKHKuom9JR7byb\"\n//val AWS_TOKEN=\"FwoGZXIvYXdzEEgaDAr20S2W9bPQ4M4ifSK/AW+Ws2BOz86aHgG259JCG3vMYjBx6Rb7DR5V5S2K6VHpm9HZDAKw1/O2vSVtxJthypaT92zAOP7E94Sh3JboGYSGdeLiQYS3ZhERw8SzapNTnUK4OtWwg6rVCJ3ncqQFtPVaDC9jfxAkDIOEat/mwbDpkVWrvykRqWaINveYgvxcIAgcCccOAS9VXE12Xe58AftlcBMcCe0nEGCAqDhZ7L7VgUzFA3y0Qyj/haB92Mkw+Bhjie9t1OSEIDwpukZ/KJO3jPEFMi2QVMR0wcmM4aXqyZmPhxvmgAWRhYm7MoXhhNwL1Le4bMxE9uY9qFP7hKmfVmU=\"\n\n// la classe AmazonS3Client n'est pas serializable\n// on rajoute l'annotation @transient pour dire a Spark de ne pas essayer de serialiser cette classe et l'envoyer aux executeurs\n//@transient val awsClient = new AmazonS3Client(new BasicSessionCredentials(AWS_ID, AWS_KEY, AWS_TOKEN))\n\n@transient val awsClient = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n\n//sc.hadoopConfiguration.set(\"fs.s3a.aws.credentials.provider\", PROVIDER) //   pour AWSeducate , retirer si compte normal\nsc.hadoopConfiguration.set(\"fs.s3a.awsAccesKeyId\", AWS_ID) // mettre votre ID du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.awsSecretAccessKey\", AWS_KEY) // mettre votre secret du fichier credentials.csv\n//sc.hadoopConfiguration.set(\"fs.s3a.session.token\", AWS_TOKEN) //   pour AWSeducate , retirer si compte normal\n\n\nawsClient.putObject(\"hiroto-yamakawa-gdelt2019\", \"masterfilelist.txt\", new File( \"/mnt/tmp/masterfilelist.txt\") )\nawsClient.putObject(\"hiroto-yamakawq-gdelt2019\", \"masterfilelist-translation.txt\", new File( \"/mnt/tmp/masterfilelist-translation.txt\") )\n","user":"anonymous","dateUpdated":"2020-01-21T08:15:45+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579594127994_-1515634565","id":"20181212-095117_1356104178","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T08:15:45+0000","dateFinished":"2020-01-21T08:15:46+0000","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6189"},{"text":"%md Verifions que le fichier a bien ete uploade dans le bucket S3 via un dataframe Spark","user":"anonymous","dateUpdated":"2020-01-21T08:08:47+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579594127995_1780066201","id":"20181212-101258_954978327","dateCreated":"2020-01-21T08:08:47+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6190"},{"text":"import org.apache.spark.sql.SQLContext\n\n\n//DF pour masterfilelist\nval sqlContext = new SQLContext(sc)\nval filesDF_eng = sqlContext.read.\n                    option(\"delimiter\",\" \").\n                    option(\"infer_schema\",\"true\").\n                    csv(\"s3a://hiroto-yamakawa-telecom-gdelt2019/masterfilelist.txt\").\n                    withColumnRenamed(\"_c0\",\"size\").\n                    withColumnRenamed(\"_c1\",\"hash\").\n                    withColumnRenamed(\"_c2\",\"url\").\n                    cache\n\n//DF pour masterfilelist-translation     \nval filesDF_translate = sqlContext.read.\n                    option(\"delimiter\",\" \").\n                    option(\"infer_schema\",\"true\").\n                    csv(\"s3a://hiroto-yamakawa-telecom-gdelt2019/masterfilelist-translation.txt\").\n                    withColumnRenamed(\"_c0\",\"size\").\n                    withColumnRenamed(\"_c1\",\"hash\").\n                    withColumnRenamed(\"_c2\",\"url\").\n                    cache\n                    \n//Concaténation des 2 fichiers                    \nval filesDF = filesDF_eng.union(filesDF_translate)","user":"anonymous","dateUpdated":"2020-01-21T09:40:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nimport org.apache.spark.sql.SQLContext\nsqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@290a5b2a\nfilesDF_eng: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nfilesDF_translate: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nfilesDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579594127995_39836425","id":"20181209-163052_14263535","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T09:40:32+0000","dateFinished":"2020-01-21T09:40:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6191"},{"text":"filesDF.show(false)","user":"anonymous","dateUpdated":"2020-01-21T09:40:37+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+--------------------------------+--------------------------------------------------------------------+\n|size    |hash                            |url                                                                 |\n+--------+--------------------------------+--------------------------------------------------------------------+\n|150383  |297a16b493de7cf6ca809a7cc31d0b93|http://data.gdeltproject.org/gdeltv2/20150218230000.export.CSV.zip  |\n|318084  |bb27f78ba45f69a17ea6ed7755e9f8ff|http://data.gdeltproject.org/gdeltv2/20150218230000.mentions.CSV.zip|\n|10768507|ea8dde0beb0ba98810a92db068c0ce99|http://data.gdeltproject.org/gdeltv2/20150218230000.gkg.csv.zip     |\n|149211  |2a91041d7e72b0fc6a629e2ff867b240|http://data.gdeltproject.org/gdeltv2/20150218231500.export.CSV.zip  |\n|339037  |dec3f427076b716a8112b9086c342523|http://data.gdeltproject.org/gdeltv2/20150218231500.mentions.CSV.zip|\n|10269336|2f1a504a3c4558694ade0442e9a5ae6f|http://data.gdeltproject.org/gdeltv2/20150218231500.gkg.csv.zip     |\n|149723  |12268e821823aae2da90882621feda18|http://data.gdeltproject.org/gdeltv2/20150218233000.export.CSV.zip  |\n|357229  |744acad14559f2781a8db67715d63872|http://data.gdeltproject.org/gdeltv2/20150218233000.mentions.CSV.zip|\n|11279827|66b03e2efd7d51dabf916b1666910053|http://data.gdeltproject.org/gdeltv2/20150218233000.gkg.csv.zip     |\n|158842  |a5298ce3c6df1a8a759c61b5c0b6f8bb|http://data.gdeltproject.org/gdeltv2/20150218234500.export.CSV.zip  |\n|374528  |dd322c888f28311aca2c735468405551|http://data.gdeltproject.org/gdeltv2/20150218234500.mentions.CSV.zip|\n|11212939|cd20f295649b214dd16666ca451b9994|http://data.gdeltproject.org/gdeltv2/20150218234500.gkg.csv.zip     |\n|362610  |c4268d558bb22c02b3c132c17818c68b|http://data.gdeltproject.org/gdeltv2/20150219000000.export.CSV.zip  |\n|287807  |e7f464a7a451ad2af6e9c8fa24f0ccea|http://data.gdeltproject.org/gdeltv2/20150219000000.mentions.CSV.zip|\n|9728953 |8f4b26e134bd6605cce2d32e92e5d3d7|http://data.gdeltproject.org/gdeltv2/20150219000000.gkg.csv.zip     |\n|251605  |7685a6c71f010918f3be0d4ed2be977e|http://data.gdeltproject.org/gdeltv2/20150219001500.export.CSV.zip  |\n|263793  |e23ee65a60a1577dc74b979a54da406e|http://data.gdeltproject.org/gdeltv2/20150219001500.mentions.CSV.zip|\n|9459370 |6031464dfdcb331551d491916d400c18|http://data.gdeltproject.org/gdeltv2/20150219001500.gkg.csv.zip     |\n|255259  |f41066efb05d4024fca9dc1c2c6b9112|http://data.gdeltproject.org/gdeltv2/20150219003000.export.CSV.zip  |\n|308019  |061133d1efd29c66c7ecba0d52063927|http://data.gdeltproject.org/gdeltv2/20150219003000.mentions.CSV.zip|\n+--------+--------------------------------+--------------------------------------------------------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579594127995_737044968","id":"20181209-185148_142944415","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T09:40:37+0000","dateFinished":"2020-01-21T09:40:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6192"},{"text":"%md Par la suite on va charger les mois de JUILLET à DECEMBRE","user":"anonymous","dateUpdated":"2020-01-21T10:28:55+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Par la suite on va charger les mois de JUILLET à DECEMBRE</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579594127995_442262558","id":"20181212-101345_616653479","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T10:28:55+0000","dateFinished":"2020-01-21T10:28:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6193"},{"text":"\n// COMMANDE POUR JUILLET - DECEMBRE\n\nval sampleDF_dec = filesDF.filter(col(\"url\").contains(\"/201912\")).cache\nval sampleDF_nov = filesDF.filter(col(\"url\").contains(\"/201911\")).cache\nval sampleDF_oct = filesDF.filter(col(\"url\").contains(\"/201910\")).cache\nval sampleDF_sep = filesDF.filter(col(\"url\").contains(\"/201909\")).cache\nval sampleDF_aug = filesDF.filter(col(\"url\").contains(\"/201908\")).cache\nval sampleDF_jul = filesDF.filter(col(\"url\").contains(\"/201907\")).cache\n\nval sampleDF= sampleDF_dec.union(sampleDF_nov).union(sampleDF_oct).union(sampleDF_sep).union(sampleDF_aug).union(sampleDF_jul)\n","user":"anonymous","dateUpdated":"2020-01-21T10:26:40+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sampleDF_dec: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nsampleDF_nov: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nsampleDF_oct: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nsampleDF_sep: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nsampleDF_aug: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nsampleDF_jul: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nsampleDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ..."}]},"apps":[],"jobName":"paragraph_1579594127996_-751297089","id":"20181209-162427_816541907","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T09:40:44+0000","dateFinished":"2020-01-21T09:40:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6194"},{"text":"sampleDF.orderBy(desc(\"url\")).show(false)","user":"anonymous","dateUpdated":"2020-01-21T09:46:30+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------------------+--------------------------------------------------------------------------------+\n|size   |hash                            |url                                                                             |\n+-------+--------------------------------+--------------------------------------------------------------------------------+\n|42102  |855c2887eab90fd21d80cfaafa88b5ef|http://data.gdeltproject.org/gdeltv2/20191231234500.translation.mentions.CSV.zip|\n|4558120|8059520f4f42ada2fa8d0b0a9f54262c|http://data.gdeltproject.org/gdeltv2/20191231234500.translation.gkg.csv.zip     |\n|22788  |a3d3e817f7518de17c64d98512c0e1e0|http://data.gdeltproject.org/gdeltv2/20191231234500.translation.export.CSV.zip  |\n|151236 |deeaf5ccb0863ddd450d055ddc4d87d7|http://data.gdeltproject.org/gdeltv2/20191231234500.mentions.CSV.zip            |\n|6653736|8c02a4ee6b28a96fb94c45472c2f0f37|http://data.gdeltproject.org/gdeltv2/20191231234500.gkg.csv.zip                 |\n|62525  |7d08ae3987d01552086a7948b102fe8d|http://data.gdeltproject.org/gdeltv2/20191231234500.export.CSV.zip              |\n|40610  |af6bb108ab9d3771b7a445b585756f4f|http://data.gdeltproject.org/gdeltv2/20191231233000.translation.mentions.CSV.zip|\n|4501972|b07fe5dcd5a67b916272d3aa8e71bbe5|http://data.gdeltproject.org/gdeltv2/20191231233000.translation.gkg.csv.zip     |\n|23459  |4afd6ebd58498df6bbc2be6af0af68ed|http://data.gdeltproject.org/gdeltv2/20191231233000.translation.export.CSV.zip  |\n|139797 |487c4f1386584354ebaf3643b7f11597|http://data.gdeltproject.org/gdeltv2/20191231233000.mentions.CSV.zip            |\n|6208061|b4538b268b88fa109481f2fa1e8d0780|http://data.gdeltproject.org/gdeltv2/20191231233000.gkg.csv.zip                 |\n|67410  |e62bd50b95e83db0d02fc4086c954b92|http://data.gdeltproject.org/gdeltv2/20191231233000.export.CSV.zip              |\n|40303  |3d7bd2b7e2bf4ee51f87eb9229da259a|http://data.gdeltproject.org/gdeltv2/20191231231500.translation.mentions.CSV.zip|\n|4286318|be2604fdda5b231f2cadf7a562dfb3dd|http://data.gdeltproject.org/gdeltv2/20191231231500.translation.gkg.csv.zip     |\n|18155  |520379b9fd7843917e91d85ef1e70bca|http://data.gdeltproject.org/gdeltv2/20191231231500.translation.export.CSV.zip  |\n|116094 |14f23734d90ef03cbbc3e4b5740555fa|http://data.gdeltproject.org/gdeltv2/20191231231500.mentions.CSV.zip            |\n|5437729|0808660cdfc3f61a7a3aacd47867d8ef|http://data.gdeltproject.org/gdeltv2/20191231231500.gkg.csv.zip                 |\n|60232  |1cf1270821a8e12b35a728c455fb6c8b|http://data.gdeltproject.org/gdeltv2/20191231231500.export.CSV.zip              |\n|33692  |097c1e49bc56bf37f60f5dbb10574d6b|http://data.gdeltproject.org/gdeltv2/20191231230000.translation.mentions.CSV.zip|\n|3888893|06d969c1c53170f25a8d06af54410188|http://data.gdeltproject.org/gdeltv2/20191231230000.translation.gkg.csv.zip     |\n+-------+--------------------------------+--------------------------------------------------------------------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579594127996_276087249","id":"20181209-184529_2045997321","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T09:46:30+0000","dateFinished":"2020-01-21T10:22:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6195"},{"text":"\n\nobject AwsClient{\n    val s3 = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n}\n\n\nsampleDF.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            val dir = \"/mnt/tmp/\"\n            val localFileName = dir + fileName\n            fileDownloader(URL,  localFileName)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(\"hiroto-yamakawa-telecom-gdelt2019\", fileName, localFile )\n            localFile.delete()\n            \n})","user":"anonymous","dateUpdated":"2020-01-21T09:41:02+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\ndefined object AwsClient\n"}]},"apps":[],"jobName":"paragraph_1579594127997_-277112989","id":"20181209-163933_1336720866","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T09:41:02+0000","dateFinished":"2020-01-21T10:22:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6196"},{"text":"%md Par la suite on va charger les mois de JANVIER à JUIN\n                                        ","user":"anonymous","dateUpdated":"2020-01-21T10:30:12+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Par la suite on va charger les mois de JANVIER à JUIN</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579594127997_-718271613","id":"20181209-184708_506680398","dateCreated":"2020-01-21T08:08:47+0000","dateStarted":"2020-01-21T10:30:12+0000","dateFinished":"2020-01-21T10:30:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6197"},{"text":"val sampleDF_jun = filesDF.filter(col(\"url\").contains(\"/201906\")).cache\nval sampleDF_may = filesDF.filter(col(\"url\").contains(\"/201905\")).cache\nval sampleDF_apr = filesDF.filter(col(\"url\").contains(\"/201904\")).cache\nval sampleDF_mar = filesDF.filter(col(\"url\").contains(\"/201903\")).cache\nval sampleDF_feb = filesDF.filter(col(\"url\").contains(\"/201902\")).cache\nval sampleDF_jan = filesDF.filter(col(\"url\").contains(\"/201901\")).cache\n\nval sampleDF2= sampleDF_jun.union(sampleDF_may).union(sampleDF_apr).union(sampleDF_mar).union(sampleDF_feb).union(sampleDF_jan)\n","user":"anonymous","dateUpdated":"2020-01-21T10:28:06+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579602437266_1912444661","id":"20200121-102717_1832273178","dateCreated":"2020-01-21T10:27:17+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:6198"},{"text":"\nobject AwsClient{\n    val s3 = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n}\n\n\nsampleDF2.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            val dir = \"/mnt/tmp/\"\n            val localFileName = dir + fileName\n            fileDownloader(URL,  localFileName)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(\"hiroto-yamakawa-telecom-gdelt2019\", fileName, localFile )\n            localFile.delete()\n            \n})","user":"anonymous","dateUpdated":"2020-01-21T10:27:55+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579602451859_57655872","id":"20200121-102731_161318033","dateCreated":"2020-01-21T10:27:31+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:6199"},{"text":"%md Verifiez via awscli sur votre machine que vous avez bien charge les donnees du 2019\n\naws s3 ls --summarize --human-readable --recursive s3://hiroto-yamakawa-telecom-gdelt2019/   ","user":"anonymous","dateUpdated":"2020-01-21T10:30:54+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Verifiez via awscli sur votre machine que vous avez bien charge les donnees du 2019</p>\n<p>aws s3 ls &ndash;summarize &ndash;human-readable &ndash;recursive s3://hiroto-yamakawa-telecom-gdelt2019/</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579602619620_739281931","id":"20200121-103019_655363109","dateCreated":"2020-01-21T10:30:19+0000","dateStarted":"2020-01-21T10:30:54+0000","dateFinished":"2020-01-21T10:30:54+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6200"},{"text":"%md\nWell done! Vous pouvez maintenaient explorer les donnees via le notebook gdeltExploration.json","user":"anonymous","dateUpdated":"2020-01-21T10:27:28+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579594127998_1900319624","id":"20181212-100557_635513911","dateCreated":"2020-01-21T08:08:47+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6201"}],"name":"gdeltETL OFFICIEL 2019 (masterfilelist et masterfilelist- translation)","id":"2F1Y6N4W3","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}